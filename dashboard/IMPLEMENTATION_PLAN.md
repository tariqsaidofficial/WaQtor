# ğŸ“‹ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø´Ø§Ù…Ù„Ø© - WaQtor Dashboard

## ğŸ¯ **Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©:**

ØªÙ… ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨. Ø§Ù„Ø®Ø·Ø© Ù…Ù‚Ø³Ù…Ø© Ø¥Ù„Ù‰ **7 Ù…Ø±Ø§Ø­Ù„** Ù…Ù†Ø¸Ù…Ø©.

---

## ğŸ“Š **Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹:**

### âœ… **Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
```
/app/(main)/
â”œâ”€â”€ dashboard/          âœ… Ù…ÙˆØ¬ÙˆØ¯Ø© (Prime Dashboard)
â”œâ”€â”€ campaigns/          âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ messages/           âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ smartbot/           âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ interactive/        âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ reports/            âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â””â”€â”€ settings/           âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
```

### âœ… **ØµÙØ­Ø§Øª Full-Page:**
```
/app/(full-page)/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ login/          âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”‚   â”œâ”€â”€ access/         âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”‚   â””â”€â”€ error/          âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ landing/            âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â””â”€â”€ pages/
    â””â”€â”€ notfound/       âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
```

### âœ… **UI Components:**
```
/app/(main)/uikit/
â”œâ”€â”€ button/             âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ charts/             âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ file/               âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ formlayout/         âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ input/              âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â”œâ”€â”€ message/            âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
â””â”€â”€ table/              âœ… Ù…ÙˆØ¬ÙˆØ¯Ø©
```

---

## ğŸš€ **Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1ï¸âƒ£: ØªØ­Ø¯ÙŠØ«Ø§Øª Topbar** âœ… (Ù…ÙƒØªÙ…Ù„Ø©)

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] ØªØ­Ø±ÙŠÙƒ Ø²Ø± Menu Toggle Ø£ÙƒØ«Ø± Ù„Ù„ÙŠØ³Ø§Ø±
- [x] Profile dropdown Ù…Ø¹ Avatar
- [x] Quick Actions panel
- [x] **ØªØ­Ø³ÙŠÙ† Avatar System:**
  - [x] Ø§Ø³ØªØ®Ø¯Ø§Ù… Label + Circle Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©
  - [x] Ø§Ø³ØªØ®Ø¯Ø§Ù… Image + Circle Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨ØµÙˆØ±Ø©
  - [x] Ø¯Ø¹Ù… Gravatar
  - [x] Ø¥Ø¶Ø§ÙØ© Badge Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
âœ… /components/layout/AppTopbar.tsx
âœ… /components/ui/layout/_topbar.scss
```

#### **Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Avatar Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø© (Label + Circle)
<Avatar 
    label={userName.charAt(0).toUpperCase()} 
    shape="circle"
    size="large"
    style={{ backgroundColor: '#0f766e', color: '#ffffff' }}
/>

// Avatar Ø¨ØµÙˆØ±Ø© (Image + Circle)
<Avatar 
    image={userAvatar}
    shape="circle"
    size="large"
/>

// Avatar Ù…Ø¹ Badge
<Avatar 
    label="U" 
    size="xlarge" 
    className="p-overlay-badge"
    shape="circle"
>
    <Badge value="4" severity="danger" />
</Avatar>
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2ï¸âƒ£: Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Profile** âœ… (Ù…ÙƒØªÙ…Ù„Ø©)

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] Ø¥Ù†Ø´Ø§Ø¡ `/app/(main)/profile/page.tsx`
- [x] ØªØµÙ…ÙŠÙ… ØµÙØ­Ø© Profile Ø§Ø­ØªØ±Ø§ÙÙŠØ©
- [x] Ø¥Ø¶Ø§ÙØ© Avatar Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø±ÙØ¹ ØµÙˆØ±Ø©
- [x] Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ)
- [x] Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
- [x] ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø§Ø·

#### **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
```typescript
- Avatar (Image/Label + Circle)
- FileUpload (Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©)
- InputText (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª)
- Button (Ø­ÙØ¸/Ø¥Ù„ØºØ§Ø¡)
- Card (Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)
- Divider (Ù„Ù„ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)
```

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
ğŸ“ /app/(main)/profile/
â”œâ”€â”€ page.tsx           (Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
â””â”€â”€ profile.css        (Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª)
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3ï¸âƒ£: Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© About** âœ…

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] Ø¥Ù†Ø´Ø§Ø¡ `/app/(main)/about/page.tsx`
- [x] Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù… (WaQtor)
- [x] Documentation links
- [x] FAQ section
- [x] ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
- [x] Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø±
- [x] Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø¹Ù…

#### **Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:**
```
1. About WaQtor
   - Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
   - Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
   - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ

2. Documentation
   - Quick Start Guide
   - API Documentation
   - User Manual

3. FAQ
   - Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©
   - Accordion component

4. Support
   - Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„
   - GitHub Issues
   - Email Support
```

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
ğŸ“ /app/(main)/about/
â”œâ”€â”€ page.tsx           (Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
â””â”€â”€ about.css          (Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª)
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4ï¸âƒ£: Ù†Ø¸Ø§Ù… BlockUI Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©** âœ… (Ù…ÙƒØªÙ…Ù„Ø©)

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] ØªØ·Ø¨ÙŠÙ‚ BlockUI Ø¹Ù„Ù‰ 3 ØµÙØ­Ø§Øª:
  - `/campaigns`
  - `/reports`
  - `/interactive`
- [x] Ø¥Ø¶Ø§ÙØ© Ù†Ø§ÙØ°Ø© InputOtp Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
- [x] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ (1234 Ù…Ø¤Ù‚ØªØ§Ù‹)
- [x] Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ localStorage

#### **Ø§Ù„ÙƒÙˆØ¯:**
```typescript
// BlockUI Template
<BlockUI 
    blocked={!isSubscribed} 
    template={
        <div className="block-ui-template">
            <i className="pi pi-lock" style={{ fontSize: '3rem' }}></i>
            <h3>Premium Feature</h3>
            <p>Subscribe or enter access code</p>
        </div>
    }
>
    {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */}
</BlockUI>

// InputOtp Dialog
<Dialog visible={showOtpDialog} onHide={() => setShowOtpDialog(false)}>
    <h3>Enter Access Code</h3>
    <InputOtp 
        value={otp} 
        onChange={(e) => setOtp(e.value)} 
        mask 
        length={4}
    />
    <Button 
        label="Verify" 
        onClick={verifyOtp}
    />
</Dialog>
```

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
ğŸ“ /components/BlockUI/
â”œâ”€â”€ ProtectedPage.tsx  (Ù…ÙƒÙˆÙ† Ù‚Ø§Ø¨Ù„ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)
â””â”€â”€ OtpDialog.tsx      (Ù†Ø§ÙØ°Ø© Ø§Ù„Ù€ OTP)
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5ï¸âƒ£: Ø¥Ø¶Ø§ÙØ© Tag "New" Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©** âœ… (Ù…ÙƒØªÙ…Ù„Ø©)

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] Ø¥Ø¶Ø§ÙØ© Tag "New" ÙÙŠ Sidebar Menu
- [x] ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ 3 ØµÙØ­Ø§Øª:
  - Campaigns
  - Reports
  - Interactive

#### **Ø§Ù„ÙƒÙˆØ¯:**
```typescript
// ÙÙŠ AppMenu.tsx
{
    label: 'Campaigns',
    icon: 'pi pi-fw pi-megaphone',
    to: '/campaigns',
    badge: 'New',
    badgeClass: 'p-badge-success'
}
```

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
âœï¸ /components/layout/AppMenu.tsx
âœï¸ /components/layout/AppMenuitem.tsx (Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Badge)
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6ï¸âƒ£: Ø¥Ø¶Ø§ÙØ© ScrollTop Ù„Ù„ØªØ·Ø¨ÙŠÙ‚** âœ… (Ù…ÙƒØªÙ…Ù„Ø©)

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [x] Ø¥Ø¶Ø§ÙØ© ScrollTop component ÙÙŠ Layout Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
- [x] ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„
- [x] ØªØµÙ…ÙŠÙ… Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø«ÙŠÙ…

#### **Ø§Ù„ÙƒÙˆØ¯:**
```typescript
// ÙÙŠ layout.tsx
<ScrollTop 
    threshold={400}
    icon="pi pi-arrow-up"
    className="custom-scrolltop"
/>
```

#### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
âœï¸ /app/(main)/layout.tsx
ğŸ“ /components/ui/layout/_scrolltop.scss
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7ï¸âƒ£: ØªØ­Ø³ÙŠÙ† UI Components**

#### **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
- [ ] Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Badge ÙÙŠ UIKit
- [ ] Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Tag ÙÙŠ UIKit
- [ ] Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Chip ÙÙŠ UIKit
- [ ] Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Avatar ÙÙŠ UIKit
- [ ] ØªØ­Ø³ÙŠÙ† ØµÙØ­Ø§Øª Auth Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] ØªØ­Ø³ÙŠÙ† ØµÙØ­Ø© Landing
- [ ] ØªØ­Ø³ÙŠÙ† ØµÙØ­Ø© NotFound

#### **Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:**
```
ğŸ“ /app/(main)/uikit/
â”œâ”€â”€ badge/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ tag/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ chip/
â”‚   â””â”€â”€ page.tsx
â””â”€â”€ avatar/
    â””â”€â”€ page.tsx
```

---

## ğŸ“¦ **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

### **1. ProtectedPage Component:**
```typescript
interface ProtectedPageProps {
    children: React.ReactNode;
    requireSubscription?: boolean;
    accessCode?: string;
}
```

### **2. OtpDialog Component:**
```typescript
interface OtpDialogProps {
    visible: boolean;
    onHide: () => void;
    onVerify: (code: string) => void;
}
```

### **3. PageHeader Component:**
```typescript
interface PageHeaderProps {
    title: string;
    subtitle?: string;
    badge?: string;
    actions?: React.ReactNode;
}
```

---

## ğŸ¨ **Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ­Ø¯:**

### **Ø§Ù„Ø£Ù„ÙˆØ§Ù†:**
```scss
$primary: #0f766e;        // WhatsApp green
$success: #16a34a;        // Green
$warning: #f59e0b;        // Orange
$danger: #ef4444;         // Red
$info: #3b82f6;           // Blue
```

### **Ø§Ù„Ù…Ø³Ø§ÙØ§Øª:**
```scss
$spacing-xs: 0.25rem;     // 4px
$spacing-sm: 0.5rem;      // 8px
$spacing-md: 1rem;        // 16px
$spacing-lg: 1.5rem;      // 24px
$spacing-xl: 2rem;        // 32px
```

### **Border Radius:**
```scss
$border-radius-sm: 6px;
$border-radius-md: 12px;
$border-radius-lg: 16px;
```

---

## ğŸ“ **LocalStorage Keys:**

```typescript
// User Settings
user_name: string
user_avatar: string
user_email: string
user_phone: string

// Branding
app_logo: string
app_logo_text: string
app_show_logo_text: boolean

// Subscriptions
subscription_status: boolean
subscription_expiry: string
access_codes: string[]

// UI Preferences
theme: string
compact_mode: boolean
sidebar_collapsed: boolean
```

---

## ğŸ”„ **ØªØ±ØªÙŠØ¨ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‚ØªØ±Ø­:**

```
1. âœ… Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ­Ø³ÙŠÙ† Topbar Avatar (30 Ø¯Ù‚ÙŠÙ‚Ø©)
2. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Ø¥Ø¶Ø§ÙØ© ScrollTop (15 Ø¯Ù‚ÙŠÙ‚Ø©)
3. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø¥Ø¶Ø§ÙØ© Tag "New" (20 Ø¯Ù‚ÙŠÙ‚Ø©)
4. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ù†Ø¸Ø§Ù… BlockUI (45 Ø¯Ù‚ÙŠÙ‚Ø©)
5. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: ØµÙØ­Ø© About (60 Ø¯Ù‚ÙŠÙ‚Ø©)
6. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØµÙØ­Ø© Profile (60 Ø¯Ù‚ÙŠÙ‚Ø©)
7. ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7: ØªØ­Ø³ÙŠÙ† UI Components (90 Ø¯Ù‚ÙŠÙ‚Ø©)
```

**Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:** ~5 Ø³Ø§Ø¹Ø§Øª

---

## âœ… **Checklist Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:**

### **Topbar:**
- [ ] ØªØ­Ø±ÙŠÙƒ Menu Toggle
- [ ] Avatar Ù…Ø¹ Label/Image
- [ ] Badge Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
- [ ] Gravatar support

### **Sidebar:**
- [ ] Ø¥Ø¶Ø§ÙØ© Profile
- [ ] Ø¥Ø¶Ø§ÙØ© About
- [ ] Tag "New" Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

### **Protected Pages:**
- [ ] BlockUI Ø¹Ù„Ù‰ Campaigns
- [ ] BlockUI Ø¹Ù„Ù‰ Reports
- [ ] BlockUI Ø¹Ù„Ù‰ Interactive
- [ ] OTP Dialog
- [ ] Subscription check

### **Global:**
- [ ] ScrollTop component
- [ ] Unified theme colors
- [ ] LocalStorage integration

### **UI Components:**
- [ ] Badge page
- [ ] Tag page
- [ ] Chip page
- [ ] Avatar page

---

## **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6ï¸âƒ£: Notification System** ğŸ””

### **Backend:**
- [ ] API Endpoints:
  - `GET /api/notifications` - Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  - `POST /api/notifications/mark-read/:id` - ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡
  - `POST /api/notifications/mark-all-read` - ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
  - `DELETE /api/notifications/:id` - Ø­Ø°Ù Ø¥Ø´Ø¹Ø§Ø±
  - `GET /api/notifications/count` - Ø¹Ø¯Ø¯ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©

- [ ] Database Schema:
  ```typescript
  interface Notification {
      id: string;
      userId: string;
      type: 'info' | 'success' | 'warning' | 'error';
      title: string;
      message: string;
      icon?: string;
      link?: string;
      read: boolean;
      createdAt: Date;
  }
  ```

- [ ] WebSocket (Optional):
  - Real-time notifications
  - Socket.io integration
  - Event: `notification:new`

### **Frontend:**
- [ ] Components:
  - `NotificationBell.tsx` - Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¬Ø±Ø³ Ù…Ø¹ Badge
  - `NotificationDropdown.tsx` - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  - `NotificationItem.tsx` - Ø¹Ù†ØµØ± Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§Ø­Ø¯
  - `NotificationCenter.tsx` - ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª

- [ ] Features:
  - [ ] Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© ÙÙŠ Badge
  - [ ] Dropdown menu Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
  - [ ] Mark as read (single/all)
  - [ ] Delete notification
  - [ ] Filter (all/unread)
  - [ ] Pagination
  - [ ] Real-time updates (WebSocket)
  - [ ] Sound notification (optional)
  - [ ] Desktop notification (optional)

- [ ] UI/UX:
  - [ ] Animation Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
  - [ ] Different icons per type
  - [ ] Time ago (e.g., "5 minutes ago")
  - [ ] Empty state
  - [ ] Loading state
  - [ ] Error handling

### **Integration:**
- [ ] AppTopbar.tsx:
  - Replace static Badge with real data
  - Add NotificationBell component
  
- [ ] Context/Store:
  - NotificationContext or Zustand store
  - Global state management
  
- [ ] API Integration:
  - Fetch notifications on mount
  - Poll every X seconds OR WebSocket
  - Update count in real-time

### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
```
ğŸ“ /components/Notifications/
â”œâ”€â”€ NotificationBell.tsx
â”œâ”€â”€ NotificationDropdown.tsx
â”œâ”€â”€ NotificationItem.tsx
â””â”€â”€ NotificationCenter.tsx

ğŸ“ /app/(main)/notifications/
â””â”€â”€ page.tsx

ğŸ“ /api/notifications/
â”œâ”€â”€ route.ts (GET, POST)
â”œâ”€â”€ [id]/route.ts (DELETE, PATCH)
â””â”€â”€ count/route.ts (GET)

ğŸ“ /contexts/
â””â”€â”€ NotificationContext.tsx

ğŸ“ /hooks/
â””â”€â”€ useNotifications.ts
```

---

## ğŸª **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8ï¸âƒ£: Webhook Dispatcher - Ø¢Ù…Ù† ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©**

### **ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… Ù†Ø¸Ø§Ù… Webhooks Ø¢Ù…Ù† Ù…Ø¹ HMAC Signature
- âœ… Ø¯Ø¹Ù… Ø£Ø­Ø¯Ø§Ø« Ù…ØªØ¹Ø¯Ø¯Ø© (message_received, message_sent, campaign_executed, client_disconnected)
- âœ… Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ Settings Ù„Ø¥Ø¯Ø§Ø±Ø© Webhooks
- âœ… Retry mechanism Ù…Ø¹ exponential backoff
- âœ… Webhook logs & monitoring

---

### **ğŸ“¡ Webhook Events:**

```typescript
type WebhookEvent = 
  | 'message_received'
  | 'message_sent'
  | 'campaign_executed'
  | 'campaign_completed'
  | 'client_connected'
  | 'client_disconnected'
  | 'smartbot_reply'
  | 'session_qr';

interface WebhookPayload {
  event: WebhookEvent;
  timestamp: string;
  data: any;
}
```

---

### **ğŸ”’ HMAC Signature (Security):**

#### **Server-Side (Signing):**

```typescript
// server/webhooks/signature.ts
import crypto from 'crypto';

export function generateSignature(payload: string, secret: string): string {
  const hmac = crypto.createHmac('sha256', secret);
  hmac.update(payload);
  return 'sha256=' + hmac.digest('hex');
}

export function verifySignature(
  payload: string,
  signature: string,
  secret: string
): boolean {
  const expectedSignature = generateSignature(payload, secret);
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}
```

#### **Client-Side (Verification):**

```typescript
// Your webhook endpoint
app.post('/webhooks/waqtor', (req, res) => {
  const signature = req.headers['x-waqtor-signature'];
  const rawBody = JSON.stringify(req.body);
  
  const secret = process.env.WEBHOOK_SECRET;
  const expectedSig = 'sha256=' + crypto
    .createHmac('sha256', secret)
    .update(rawBody)
    .digest('hex');
  
  if (signature !== expectedSig) {
    return res.status(401).json({ error: 'Invalid signature' });
  }
  
  // Process webhook
  console.log('Webhook received:', req.body);
  res.status(200).json({ received: true });
});
```

---

### **ğŸ”§ Backend Implementation:**

#### **1. Webhook Manager:**

```typescript
// server/webhooks/WebhookManager.ts
import axios from 'axios';
import { EventBus } from '@waqtor/core';
import { generateSignature } from './signature';

interface WebhookConfig {
  id: string;
  url: string;
  events: WebhookEvent[];
  secret: string;
  enabled: boolean;
  retryAttempts: number;
  retryDelay: number;
}

export class WebhookManager {
  private webhooks: Map<string, WebhookConfig> = new Map();
  private eventBus: EventBus;

  constructor(eventBus: EventBus) {
    this.eventBus = eventBus;
    this.setupEventListeners();
  }

  private setupEventListeners() {
    // Message received
    this.eventBus.on('message.received', (data) => {
      this.dispatch('message_received', data);
    });

    // Message sent
    this.eventBus.on('message.sent', (data) => {
      this.dispatch('message_sent', data);
    });

    // Campaign executed
    this.eventBus.on('campaign.progress', (data) => {
      this.dispatch('campaign_executed', data);
    });

    // Campaign completed
    this.eventBus.on('campaign.completed', (data) => {
      this.dispatch('campaign_completed', data);
    });

    // Client connected
    this.eventBus.on('session.status', (data) => {
      if (data.status === 'ready') {
        this.dispatch('client_connected', data);
      } else if (data.status === 'disconnected') {
        this.dispatch('client_disconnected', data);
      }
    });

    // SmartBot reply
    this.eventBus.on('smartbot.reply', (data) => {
      this.dispatch('smartbot_reply', data);
    });

    // Session QR
    this.eventBus.on('session.qr', (data) => {
      this.dispatch('session_qr', data);
    });
  }

  async dispatch(event: WebhookEvent, data: any) {
    const webhooks = Array.from(this.webhooks.values())
      .filter(wh => wh.enabled && wh.events.includes(event));

    for (const webhook of webhooks) {
      await this.sendWebhook(webhook, event, data);
    }
  }

  private async sendWebhook(
    webhook: WebhookConfig,
    event: WebhookEvent,
    data: any,
    attempt: number = 1
  ) {
    const payload: WebhookPayload = {
      event,
      timestamp: new Date().toISOString(),
      data
    };

    const rawBody = JSON.stringify(payload);
    const signature = generateSignature(rawBody, webhook.secret);

    try {
      const response = await axios.post(webhook.url, payload, {
        headers: {
          'Content-Type': 'application/json',
          'X-Waqtor-Signature': signature,
          'X-Waqtor-Event': event,
          'User-Agent': 'WaQtor-Webhook/2.2.0'
        },
        timeout: 10000
      });

      // Log success
      await this.logWebhook(webhook.id, event, 'success', response.status);
    } catch (error: any) {
      console.error(`Webhook failed (attempt ${attempt}):`, error.message);

      // Retry with exponential backoff
      if (attempt < webhook.retryAttempts) {
        const delay = webhook.retryDelay * Math.pow(2, attempt - 1);
        setTimeout(() => {
          this.sendWebhook(webhook, event, data, attempt + 1);
        }, delay);
      } else {
        // Log failure
        await this.logWebhook(webhook.id, event, 'failed', error.response?.status);
      }
    }
  }

  private async logWebhook(
    webhookId: string,
    event: string,
    status: 'success' | 'failed',
    statusCode?: number
  ) {
    // Save to database or file
    console.log(`Webhook Log: ${webhookId} - ${event} - ${status} - ${statusCode}`);
  }

  // CRUD operations
  addWebhook(config: WebhookConfig) {
    this.webhooks.set(config.id, config);
  }

  removeWebhook(id: string) {
    this.webhooks.delete(id);
  }

  updateWebhook(id: string, updates: Partial<WebhookConfig>) {
    const webhook = this.webhooks.get(id);
    if (webhook) {
      this.webhooks.set(id, { ...webhook, ...updates });
    }
  }

  getWebhook(id: string): WebhookConfig | undefined {
    return this.webhooks.get(id);
  }

  getAllWebhooks(): WebhookConfig[] {
    return Array.from(this.webhooks.values());
  }
}
```

#### **2. API Routes:**

```typescript
// server/api/webhooks.ts
import express from 'express';
import { WebhookManager } from '../webhooks/WebhookManager';

const router = express.Router();

// Get all webhooks
router.get('/webhooks', (req, res) => {
  const webhooks = webhookManager.getAllWebhooks();
  res.json({ webhooks });
});

// Create webhook
router.post('/webhooks', (req, res) => {
  const { url, events, secret } = req.body;
  
  const webhook = {
    id: generateId(),
    url,
    events,
    secret: secret || generateSecret(),
    enabled: true,
    retryAttempts: 3,
    retryDelay: 1000
  };
  
  webhookManager.addWebhook(webhook);
  res.status(201).json({ webhook });
});

// Update webhook
router.patch('/webhooks/:id', (req, res) => {
  const { id } = req.params;
  const updates = req.body;
  
  webhookManager.updateWebhook(id, updates);
  res.json({ success: true });
});

// Delete webhook
router.delete('/webhooks/:id', (req, res) => {
  const { id } = req.params;
  webhookManager.removeWebhook(id);
  res.json({ success: true });
});

// Test webhook
router.post('/webhooks/:id/test', async (req, res) => {
  const { id } = req.params;
  const webhook = webhookManager.getWebhook(id);
  
  if (!webhook) {
    return res.status(404).json({ error: 'Webhook not found' });
  }
  
  // Send test payload
  await webhookManager.dispatch('message_received', {
    from: 'test@c.us',
    body: 'Test message',
    timestamp: new Date().toISOString()
  });
  
  res.json({ success: true, message: 'Test webhook sent' });
});

export default router;
```

---

### **ğŸ’» Dashboard Implementation:**

#### **1. Webhook Settings Page:**

```typescript
// dashboard/src/app/(main)/settings/webhooks/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { DataTable } from 'primereact/datatable';
import { Column } from 'primereact/column';
import { Button } from 'primereact/button';
import { Dialog } from 'primereact/dialog';
import { InputText } from 'primereact/inputtext';
import { MultiSelect } from 'primereact/multiselect';
import { InputSwitch } from 'primereact/inputswitch';
import { Card } from 'primereact/card';
import { Toast } from 'primereact/toast';
import axios from 'axios';

const WEBHOOK_EVENTS = [
  { label: 'Message Received', value: 'message_received' },
  { label: 'Message Sent', value: 'message_sent' },
  { label: 'Campaign Executed', value: 'campaign_executed' },
  { label: 'Campaign Completed', value: 'campaign_completed' },
  { label: 'Client Connected', value: 'client_connected' },
  { label: 'Client Disconnected', value: 'client_disconnected' },
  { label: 'SmartBot Reply', value: 'smartbot_reply' },
  { label: 'Session QR', value: 'session_qr' }
];

export default function WebhooksPage() {
  const [webhooks, setWebhooks] = useState([]);
  const [showDialog, setShowDialog] = useState(false);
  const [editingWebhook, setEditingWebhook] = useState(null);
  const [formData, setFormData] = useState({
    url: '',
    events: [],
    secret: '',
    enabled: true
  });

  useEffect(() => {
    loadWebhooks();
  }, []);

  const loadWebhooks = async () => {
    try {
      const response = await axios.get('/api/webhooks');
      setWebhooks(response.data.webhooks);
    } catch (error) {
      console.error('Failed to load webhooks:', error);
    }
  };

  const handleSave = async () => {
    try {
      if (editingWebhook) {
        await axios.patch(`/api/webhooks/${editingWebhook.id}`, formData);
      } else {
        await axios.post('/api/webhooks', formData);
      }
      
      setShowDialog(false);
      loadWebhooks();
      toast.current.show({
        severity: 'success',
        summary: 'Success',
        detail: 'Webhook saved successfully'
      });
    } catch (error) {
      console.error('Failed to save webhook:', error);
    }
  };

  const handleDelete = async (id: string) => {
    try {
      await axios.delete(`/api/webhooks/${id}`);
      loadWebhooks();
    } catch (error) {
      console.error('Failed to delete webhook:', error);
    }
  };

  const handleTest = async (id: string) => {
    try {
      await axios.post(`/api/webhooks/${id}/test`);
      toast.current.show({
        severity: 'info',
        summary: 'Test Sent',
        detail: 'Test webhook has been dispatched'
      });
    } catch (error) {
      console.error('Failed to test webhook:', error);
    }
  };

  const actionTemplate = (rowData: any) => {
    return (
      <div className="flex gap-2">
        <Button
          icon="pi pi-pencil"
          size="small"
          onClick={() => {
            setEditingWebhook(rowData);
            setFormData(rowData);
            setShowDialog(true);
          }}
        />
        <Button
          icon="pi pi-send"
          size="small"
          severity="info"
          onClick={() => handleTest(rowData.id)}
        />
        <Button
          icon="pi pi-trash"
          size="small"
          severity="danger"
          onClick={() => handleDelete(rowData.id)}
        />
      </div>
    );
  };

  return (
    <div className="grid">
      <div className="col-12">
        <Card title="Webhooks Management">
          <div className="mb-3">
            <Button
              label="Add Webhook"
              icon="pi pi-plus"
              onClick={() => {
                setEditingWebhook(null);
                setFormData({ url: '', events: [], secret: '', enabled: true });
                setShowDialog(true);
              }}
            />
          </div>

          <DataTable value={webhooks} paginator rows={10}>
            <Column field="url" header="URL" />
            <Column
              field="events"
              header="Events"
              body={(rowData) => rowData.events.join(', ')}
            />
            <Column
              field="enabled"
              header="Status"
              body={(rowData) => (
                <span className={`badge ${rowData.enabled ? 'badge-success' : 'badge-danger'}`}>
                  {rowData.enabled ? 'Enabled' : 'Disabled'}
                </span>
              )}
            />
            <Column header="Actions" body={actionTemplate} />
          </DataTable>
        </Card>
      </div>

      <Dialog
        visible={showDialog}
        onHide={() => setShowDialog(false)}
        header={editingWebhook ? 'Edit Webhook' : 'Add Webhook'}
        style={{ width: '600px' }}
      >
        <div className="flex flex-column gap-3">
          <div>
            <label>Webhook URL</label>
            <InputText
              value={formData.url}
              onChange={(e) => setFormData({ ...formData, url: e.target.value })}
              className="w-full"
              placeholder="https://yourapp.com/webhooks/waqtor"
            />
          </div>

          <div>
            <label>Events</label>
            <MultiSelect
              value={formData.events}
              onChange={(e) => setFormData({ ...formData, events: e.value })}
              options={WEBHOOK_EVENTS}
              className="w-full"
              placeholder="Select events"
            />
          </div>

          <div>
            <label>Secret Key</label>
            <InputText
              value={formData.secret}
              onChange={(e) => setFormData({ ...formData, secret: e.target.value })}
              className="w-full"
              placeholder="Leave empty to auto-generate"
            />
          </div>

          <div className="flex align-items-center gap-2">
            <label>Enabled</label>
            <InputSwitch
              checked={formData.enabled}
              onChange={(e) => setFormData({ ...formData, enabled: e.value })}
            />
          </div>

          <div className="flex justify-content-end gap-2">
            <Button label="Cancel" severity="secondary" onClick={() => setShowDialog(false)} />
            <Button label="Save" onClick={handleSave} />
          </div>
        </div>
      </Dialog>

      <Toast ref={toast} />
    </div>
  );
}
```

---

### **ğŸ“ Example Usage:**

#### **cURL Test:**

```bash
# Test webhook endpoint
curl -X POST https://yourapp.com/webhooks/waqtor \
  -H "X-Waqtor-Signature: sha256=abc123..." \
  -H "X-Waqtor-Event: message_received" \
  -H "Content-Type: application/json" \
  -d '{
    "event": "message_received",
    "timestamp": "2025-10-30T19:30:00Z",
    "data": {
      "from": "9715...@c.us",
      "body": "Hi",
      "messageId": "msg_123",
      "isGroup": false
    }
  }'
```

#### **Node.js Webhook Receiver:**

```javascript
const express = require('express');
const crypto = require('crypto');

const app = express();
app.use(express.json());

const WEBHOOK_SECRET = 'your_secret_here';

app.post('/webhooks/waqtor', (req, res) => {
  // Verify signature
  const signature = req.headers['x-waqtor-signature'];
  const rawBody = JSON.stringify(req.body);
  
  const expectedSig = 'sha256=' + crypto
    .createHmac('sha256', WEBHOOK_SECRET)
    .update(rawBody)
    .digest('hex');
  
  if (signature !== expectedSig) {
    return res.status(401).json({ error: 'Invalid signature' });
  }
  
  // Process webhook
  const { event, data } = req.body;
  
  switch (event) {
    case 'message_received':
      console.log('New message from:', data.from);
      console.log('Message body:', data.body);
      break;
      
    case 'campaign_completed':
      console.log('Campaign completed:', data.campaignId);
      console.log('Total sent:', data.totalSent);
      break;
      
    default:
      console.log('Unknown event:', event);
  }
  
  res.status(200).json({ received: true });
});

app.listen(3000, () => {
  console.log('Webhook receiver running on port 3000');
});
```

---

### **ğŸ“Š Webhook Logs & Monitoring:**

```typescript
// Dashboard component for webhook logs
interface WebhookLog {
  id: string;
  webhookId: string;
  event: string;
  status: 'success' | 'failed';
  statusCode: number;
  timestamp: Date;
  responseTime: number;
}

export function WebhookLogs() {
  const [logs, setLogs] = useState<WebhookLog[]>([]);

  return (
    <Card title="Webhook Logs">
      <DataTable value={logs} paginator rows={20}>
        <Column field="timestamp" header="Time" />
        <Column field="event" header="Event" />
        <Column field="status" header="Status" />
        <Column field="statusCode" header="Status Code" />
        <Column field="responseTime" header="Response Time (ms)" />
      </DataTable>
    </Card>
  );
}
```

---

### **ğŸ”§ Configuration (.env):**

```bash
# Webhook settings
WEBHOOK_SECRET=your_super_secret_key_here
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_RETRY_DELAY=1000
WEBHOOK_TIMEOUT=10000
```

---

### **ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

```
ğŸ“ packages/server/src/webhooks/
â”œâ”€â”€ WebhookManager.ts          # Webhook dispatcher
â”œâ”€â”€ signature.ts               # HMAC signature utilities
â””â”€â”€ types.ts                   # TypeScript definitions

ğŸ“ packages/server/src/api/
â””â”€â”€ webhooks.ts                # Webhook CRUD API

ğŸ“ dashboard/src/app/(main)/settings/webhooks/
â”œâ”€â”€ page.tsx                   # Webhooks management page
â””â”€â”€ logs/
    â””â”€â”€ page.tsx               # Webhook logs page

ğŸ“ documentation/
â””â”€â”€ WEBHOOKS.md                # Webhook documentation
```

---

### **âœ… Features:**

- âœ… **HMAC Signature**: Secure webhook verification
- âœ… **Multiple Events**: 8 supported events
- âœ… **Retry Mechanism**: Exponential backoff (3 attempts)
- âœ… **Dashboard UI**: Full CRUD interface
- âœ… **Test Endpoint**: Send test webhooks
- âœ… **Logs & Monitoring**: Track webhook deliveries
- âœ… **Enable/Disable**: Toggle webhooks on/off
- âœ… **Secret Management**: Auto-generate or custom secrets

---

## ğŸ¤– **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 9ï¸âƒ£: SmartBot AI Engine v2 - Ù…Ù† Fuzzy Ø¥Ù„Ù‰ Semantic Matching**

### **ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… ØªØ±Ù‚ÙŠØ© Ù…Ù† Fuzzy Matching Ø¥Ù„Ù‰ Semantic Matching
- âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Embeddings (MiniLM/MPNet) Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªØ¬Ù‡ÙŠ
- âœ… Confidence scoring Ù„ÙƒÙ„ Ø±Ø¯
- âœ… Template expansion Ù…Ø¹ Ù…ØªØºÙŠØ±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
- âœ… Learning loop Ù…Ø¹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø´Ø±ÙŠØ©
- âœ… Ù†Ù‚Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù† JSON Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ø§Ø¦Ù‚ÙŠØ©

### **ğŸ“Š Pipeline: Message â†’ Language Detection â†’ Embedding â†’ Semantic Search â†’ Safety â†’ Template â†’ Response â†’ Learning**

### **ğŸ—„ï¸ Database Schema:**
- `smartbot_rules` (enhanced with tone, variables, priority)
- `smartbot_embeddings` (NEW - stores 384-dim vectors)
- `smartbot_history` (migrated from JSON)
- `smartbot_suggestions` (NEW - learning loop)

### **ğŸ”§ Components:**
- EmbeddingService (Xenova transformers)
- SmartBotEngineV2 (main pipeline)
- TemplateEngine (variable expansion)
- SafetyLayer (profanity + no-reply rules)

### **ğŸ’» Dashboard Features:**
- Rule List + "Generate Embedding" button
- Test Bench (Top-3 matches + confidence)
- Auto-Improve (suggestions from unmatched queries)

---

## ğŸ—ï¸ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 10: Architecture Evolution - Ù…Ù† Monolith Ø¥Ù„Ù‰ Modular Microkernel**

### **ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø±Ùƒ Ø¨Ø¯ÙˆÙ† ÙƒØ³Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Backward Compatibility)
- âœ… Ø¯Ø¹Ù… Multi-Instance Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹
- âœ… Ù†Ø´Ø± SDK Ø±Ø³Ù…ÙŠ (Node.js + Python)
- âœ… ÙØµÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª (Separation of Concerns)
- âœ… Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©

---

### **ğŸ“¦ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­ (Mono-Repo):**

```
waqtor/
â”œâ”€ packages/
â”‚  â”œâ”€ core/                 # @waqtor/core  â† Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
â”‚  â”‚  â”œâ”€ src/
â”‚  â”‚  â”‚  â”œâ”€ engine/         # WhatsAppClient, SessionManager, EventBus
â”‚  â”‚  â”‚  â”œâ”€ campaigns/      # CampaignEngine (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰)
â”‚  â”‚  â”‚  â”œâ”€ storage/        # Storage adapters: sqlite | memory
â”‚  â”‚  â”‚  â””â”€ plugins/        # Plugin interfaces (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
â”‚  â”‚  â”œâ”€ index.ts
â”‚  â”‚  â””â”€ package.json
â”‚  â”‚
â”‚  â”œâ”€ server/               # @waqtor/server â† REST + WS + Webhooks
â”‚  â”‚  â”œâ”€ src/
â”‚  â”‚  â”‚  â”œâ”€ api/            # Routes: /messages, /campaigns, /status, /webhooks
â”‚  â”‚  â”‚  â”œâ”€ ws/             # WebSocket 2.0 namespaces
â”‚  â”‚  â”‚  â”œâ”€ middleware/     # Auth, Rate limiting, CORS
â”‚  â”‚  â”‚  â””â”€ bootstrap.ts    # Dependency Injection (ÙŠØ­Ù‚Ù† Core)
â”‚  â”‚  â”œâ”€ index.ts
â”‚  â”‚  â””â”€ package.json
â”‚  â”‚
â”‚  â”œâ”€ sdk-node/             # @waqtor/sdk (Node.js SDK)
â”‚  â”‚  â”œâ”€ src/
â”‚  â”‚  â”‚  â”œâ”€ client.ts       # WaqtorClient class
â”‚  â”‚  â”‚  â”œâ”€ types.ts        # TypeScript definitions
â”‚  â”‚  â”‚  â””â”€ utils.ts        # Helper functions
â”‚  â”‚  â”œâ”€ index.ts
â”‚  â”‚  â””â”€ package.json
â”‚  â”‚
â”‚  â””â”€ sdk-py/               # waqtor (Python SDK)
â”‚     â”œâ”€ waqtor/
â”‚     â”‚  â”œâ”€ __init__.py
â”‚     â”‚  â”œâ”€ client.py       # WaqtorClient class
â”‚     â”‚  â””â”€ types.py        # Type hints
â”‚     â”œâ”€ setup.py
â”‚     â””â”€ README.md
â”‚
â””â”€ apps/
   â”œâ”€ dashboard/            # Next.js 14 (Sakai Theme)
   â”‚  â””â”€ (current structure)
   â”‚
   â””â”€ examples/
      â”œâ”€ basic-bot/
      â”œâ”€ campaign-scheduler/
      â””â”€ webhook-handler/
```

---

### **ğŸ”’ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø¸Ø§ÙØ© (Separation of Concerns):**

#### **1. @waqtor/core** (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
```typescript
// âœ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª:
- Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© WhatsApp (SessionManager)
- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (EventBus)
- Ø¥Ø±Ø³Ø§Ù„/Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª (Campaign Engine)
- Storage abstraction

// âŒ Ù„Ø§ ÙŠØ¹Ø±Ù Ø´ÙŠØ¦Ø§Ù‹ Ø¹Ù†:
- Express.js
- Next.js
- HTTP/REST
- WebSocket
- UI/Frontend
```

#### **2. @waqtor/server** (Ø·Ø¨Ù‚Ø© Ø§Ù„Ù€ API)
```typescript
// âœ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª:
- REST API endpoints
- WebSocket server
- Webhooks
- Authentication & Authorization
- Rate limiting
- CORS handling

// âŒ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
- UI components
- Frontend logic
- Direct WhatsApp logic (ÙŠØ³ØªÙ‡Ù„Ùƒ core ÙÙ‚Ø·)
```

#### **3. Dashboard** (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©)
```typescript
// âœ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª:
- UI/UX
- User interactions
- Data visualization
- Real-time updates

// âŒ Ù„Ø§ ÙŠØ¹Ø±Ù Ø´ÙŠØ¦Ø§Ù‹ Ø¹Ù†:
- WhatsApp internals
- Puppeteer
- Session management
- (ÙŠØ³ØªÙ‡Ù„Ùƒ REST/WS ÙÙ‚Ø·)
```

---

### **ğŸ“¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø± (Contracts):**

#### **Events** (ÙŠÙØ¨Ø«Ù‘Ù‡Ø§ `@waqtor/core`):
```typescript
type CoreEvents =
  | { 
      type: 'session.qr'; 
      data: { qr: string; timestamp: string } 
    }
  | { 
      type: 'session.status'; 
      data: { 
        status: 'ready' | 'disconnected' | 'auth_failure' | 'connecting'; 
        timestamp: string;
        clientInfo?: {
          platform: string;
          phoneNumber: string;
          name: string;
        }
      } 
    }
  | { 
      type: 'message.received'; 
      data: { 
        from: string; 
        body: string; 
        timestamp: string;
        messageId: string;
        isGroup: boolean;
      } 
    }
  | { 
      type: 'message.sent'; 
      data: { 
        to: string; 
        messageId: string; 
        timestamp: string;
        status: 'pending' | 'sent' | 'delivered' | 'read' | 'failed';
      } 
    }
  | { 
      type: 'campaign.progress'; 
      data: { 
        campaignId: string; 
        sent: number; 
        total: number; 
        failed: number;
        status: 'running' | 'paused' | 'completed' | 'failed';
      } 
    }
  | {
      type: 'smartbot.reply';
      data: {
        to: string;
        trigger: string;
        response: string;
        timestamp: string;
      }
    };
```

#### **Commands** (ÙŠØ³ØªÙ‚Ø¨Ù„Ù‡Ø§ `@waqtor/core`):
```typescript
interface CoreCommands {
  // Message Commands
  sendText(params: {
    chatId: string;
    text: string;
    options?: {
      quotedMessageId?: string;
      mentionedIds?: string[];
    };
  }): Promise<{ messageId: string; timestamp: string }>;

  sendMedia(params: {
    chatId: string;
    media: string | Buffer;
    type: 'image' | 'video' | 'audio' | 'document';
    caption?: string;
    filename?: string;
  }): Promise<{ messageId: string; timestamp: string }>;

  // Campaign Commands
  createCampaign(params: {
    name: string;
    recipients: string[];
    template: string;
    variables?: Record<string, any>;
    scheduleAt?: Date;
  }): Promise<{ campaignId: string }>;

  controlCampaign(params: {
    campaignId: string;
    action: 'pause' | 'resume' | 'cancel';
  }): Promise<{ status: string }>;

  // Session Commands
  getSessionState(): Promise<{
    status: 'ready' | 'disconnected' | 'connecting';
    clientInfo?: ClientInfo;
  }>;

  logout(): Promise<void>;
  
  restartSession(): Promise<void>;
}
```

---

### **ğŸ”Œ Plugin System (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):**

```typescript
// @waqtor/core/src/plugins/interface.ts
interface WaqtorPlugin {
  name: string;
  version: string;
  
  // Lifecycle hooks
  onLoad?(core: WaqtorCore): void;
  onMessage?(message: Message): void | Promise<void>;
  onSessionChange?(status: SessionStatus): void;
  
  // Custom commands
  commands?: Record<string, PluginCommand>;
}

// Example: SmartBot Plugin
class SmartBotPlugin implements WaqtorPlugin {
  name = 'smartbot';
  version = '1.0.0';
  
  async onMessage(message: Message) {
    const reply = await this.matchRule(message.body);
    if (reply) {
      await message.reply(reply);
    }
  }
  
  private async matchRule(text: string): Promise<string | null> {
    // Smart matching logic
  }
}
```

---

### **ğŸ“š SDK Examples:**

#### **Node.js SDK (@waqtor/sdk):**
```typescript
import { WaqtorClient } from '@waqtor/sdk';

const client = new WaqtorClient({
  apiUrl: 'http://localhost:8080',
  apiKey: 'your_api_key_here'
});

// Send message
await client.messages.send({
  to: '966501234567@c.us',
  text: 'Hello from Waqtor SDK!'
});

// Listen to events
client.on('message.received', (data) => {
  console.log('New message:', data);
});

// Create campaign
const campaign = await client.campaigns.create({
  name: 'New Year Sale',
  recipients: ['966501234567@c.us', '966501234568@c.us'],
  template: 'Happy New Year! Get {{discount}}% off!',
  variables: { discount: 50 }
});
```

#### **Python SDK (waqtor):**
```python
from waqtor import WaqtorClient

client = WaqtorClient(
    api_url='http://localhost:8080',
    api_key='your_api_key_here'
)

# Send message
client.messages.send(
    to='966501234567@c.us',
    text='Hello from Waqtor Python SDK!'
)

# Listen to events
@client.on('message.received')
def on_message(data):
    print(f"New message: {data}")

# Create campaign
campaign = client.campaigns.create(
    name='New Year Sale',
    recipients=['966501234567@c.us', '966501234568@c.us'],
    template='Happy New Year! Get {{discount}}% off!',
    variables={'discount': 50}
)
```

---

### **ğŸ”„ Migration Path (Ø®Ø·Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„):**

#### **Phase 1: Refactor Core** (4-6 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- [ ] Ø§Ø³ØªØ®Ø±Ø§Ø¬ `@waqtor/core` Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
- [ ] ØªØ·Ø¨ÙŠÙ‚ EventBus pattern
- [ ] ØªØ¹Ø±ÙŠÙ Contracts (Events + Commands)
- [ ] Unit tests Ù„Ù„Ù€ core
- [ ] Documentation

#### **Phase 2: Isolate Server** (2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- [ ] Ù†Ù‚Ù„ REST API Ø¥Ù„Ù‰ `@waqtor/server`
- [ ] Dependency Injection Ù„Ù„Ù€ core
- [ ] WebSocket refactoring
- [ ] Integration tests
- [ ] API versioning (v1, v2)

#### **Phase 3: Build SDKs** (3-4 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- [ ] ØªØ·ÙˆÙŠØ± `@waqtor/sdk` (Node.js)
- [ ] ØªØ·ÙˆÙŠØ± `waqtor` (Python)
- [ ] TypeScript definitions
- [ ] SDK documentation
- [ ] Example projects

#### **Phase 4: Dashboard Migration** (1-2 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- [ ] Ø§Ø³ØªØ®Ø¯Ø§Ù… SDK Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Axios Ù…Ø¨Ø§Ø´Ø±Ø©
- [ ] ØªØ­Ø¯ÙŠØ« WebSocket client
- [ ] Testing & validation
- [ ] Performance optimization

#### **Phase 5: Multi-Instance Support** (2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- [ ] Instance Manager
- [ ] Database per instance
- [ ] Load balancing
- [ ] Monitoring & health checks

---

### **ğŸ“Š Benefits (Ø§Ù„ÙÙˆØ§Ø¦Ø¯):**

#### **1. Maintainability (Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©)**
- âœ… ÙƒÙ„ package Ù„Ù‡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
- âœ… ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø¹Ø²ÙˆÙ„Ø© (update core Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ server)
- âœ… Testing Ø£Ø³Ù‡Ù„ (unit tests per package)

#### **2. Scalability (Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªÙˆØ³Ø¹)**
- âœ… Multi-instance support
- âœ… Horizontal scaling
- âœ… Plugin system Ù„Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©

#### **3. Developer Experience**
- âœ… SDK Ø±Ø³Ù…ÙŠ Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
- âœ… TypeScript support ÙƒØ§Ù…Ù„
- âœ… Documentation ÙˆØ§Ø¶Ø­Ø©
- âœ… Examples Ø¬Ø§Ù‡Ø²Ø©

#### **4. Backward Compatibility**
- âœ… Ø§Ù„Ù€ API Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
- âœ… Dashboard ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±Ø§Øª
- âœ… Migration ØªØ¯Ø±ÙŠØ¬ÙŠØ© (phased approach)

---

### **ğŸ§ª Testing Strategy:**

```typescript
// @waqtor/core tests
describe('SessionManager', () => {
  it('should emit qr event on initialization', async () => {
    const manager = new SessionManager();
    const qrPromise = new Promise(resolve => {
      manager.on('session.qr', resolve);
    });
    
    await manager.initialize();
    const qrData = await qrPromise;
    
    expect(qrData).toHaveProperty('qr');
  });
});

// @waqtor/server tests
describe('POST /api/messages/send-text', () => {
  it('should send message and return messageId', async () => {
    const response = await request(app)
      .post('/api/messages/send-text')
      .set('X-API-Key', 'test_key')
      .send({
        chatId: '966501234567@c.us',
        text: 'Test message'
      });
    
    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('messageId');
  });
});

// @waqtor/sdk tests
describe('WaqtorClient', () => {
  it('should send message via SDK', async () => {
    const client = new WaqtorClient({ apiKey: 'test' });
    const result = await client.messages.send({
      to: '966501234567@c.us',
      text: 'SDK test'
    });
    
    expect(result).toHaveProperty('messageId');
  });
});
```

---

### **ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

```
ğŸ“ packages/core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ WhatsAppClient.ts
â”‚   â”‚   â”œâ”€â”€ SessionManager.ts
â”‚   â”‚   â””â”€â”€ EventBus.ts
â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”œâ”€â”€ CampaignEngine.ts
â”‚   â”‚   â””â”€â”€ CampaignScheduler.ts
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ StorageAdapter.ts
â”‚   â”‚   â”œâ”€â”€ SQLiteAdapter.ts
â”‚   â”‚   â””â”€â”€ MemoryAdapter.ts
â”‚   â”œâ”€â”€ plugins/
â”‚   â”‚   â”œâ”€â”€ PluginInterface.ts
â”‚   â”‚   â””â”€â”€ PluginManager.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ events.ts
â”‚   â”‚   â””â”€â”€ commands.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ tests/
â”œâ”€â”€ package.json
â””â”€â”€ README.md

ğŸ“ packages/server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ messages.ts
â”‚   â”‚   â”œâ”€â”€ campaigns.ts
â”‚   â”‚   â”œâ”€â”€ status.ts
â”‚   â”‚   â””â”€â”€ webhooks.ts
â”‚   â”œâ”€â”€ ws/
â”‚   â”‚   â””â”€â”€ websocket.ts
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ rateLimit.ts
â”‚   â”‚   â””â”€â”€ cors.ts
â”‚   â”œâ”€â”€ bootstrap.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ tests/
â”œâ”€â”€ package.json
â””â”€â”€ README.md

ğŸ“ packages/sdk-node/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ client.ts
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ messages.ts
â”‚   â”‚   â”œâ”€â”€ campaigns.ts
â”‚   â”‚   â””â”€â”€ status.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ tests/
â”œâ”€â”€ examples/
â”œâ”€â”€ package.json
â””â”€â”€ README.md

ğŸ“ packages/sdk-py/
â”œâ”€â”€ waqtor/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ client.py
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ messages.py
â”‚   â”‚   â”œâ”€â”€ campaigns.py
â”‚   â”‚   â””â”€â”€ status.py
â”‚   â””â”€â”€ types.py
â”œâ”€â”€ tests/
â”œâ”€â”€ examples/
â”œâ”€â”€ setup.py
â””â”€â”€ README.md
```

---

### **â±ï¸ Timeline (Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ):**

| Phase | Duration | Deliverables |
|-------|----------|--------------|
| **Phase 1** | 4-6 weeks | `@waqtor/core` package |
| **Phase 2** | 2-3 weeks | `@waqtor/server` package |
| **Phase 3** | 3-4 weeks | SDKs (Node + Python) |
| **Phase 4** | 1-2 weeks | Dashboard migration |
| **Phase 5** | 2-3 weeks | Multi-instance support |
| **Total** | **12-18 weeks** | Full modular architecture |

---

### **ğŸ¯ Success Metrics:**

- âœ… **Code Coverage**: > 80% for all packages
- âœ… **API Compatibility**: 100% backward compatible
- âœ… **Performance**: No regression in response times
- âœ… **Bundle Size**: Core < 500KB, SDK < 100KB
- âœ… **Documentation**: 100% API coverage
- âœ… **Developer Adoption**: 10+ community projects using SDK

---

## ğŸ”Œ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 9ï¸âƒ£: Integration Layer - WebSocket 2.0 (Event-Driven + Namespaces)**

### **ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¹Ø¨Ø± Namespaces
- âœ… Heartbeat + Auto-Reconnect
- âœ… Backpressure handling Ù„Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ÙƒØ«ÙŠÙØ©
- âœ… Reliable real-time communication
- âœ… Better error handling & recovery

---

### **ğŸ“¡ WebSocket Architecture:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (@waqtor/server)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Socket.io Server                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ /status    â”‚  â”‚ /campaigns â”‚  â”‚ /smartbot  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ namespace  â”‚  â”‚ namespace  â”‚  â”‚ namespace  â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚               â”‚               â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                           â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚  EventBus   â”‚                         â”‚
â”‚                    â”‚  (@waqtor/  â”‚                         â”‚
â”‚                    â”‚   core)     â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ WebSocket
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Dashboard)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Socket.io Client (Multiple Namespaces)     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ /status    â”‚  â”‚ /campaigns â”‚  â”‚ /smartbot  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ client     â”‚  â”‚ client     â”‚  â”‚ client     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚               â”‚               â”‚                â”‚
â”‚           â–¼               â–¼               â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Zustand Store / Context                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **ğŸ”§ Server Implementation (@waqtor/server):**

#### **1. WebSocket Server Setup:**

```typescript
// ws/index.ts
import { Server } from 'socket.io';
import { EventBus } from '@waqtor/core';

export function setupWebSocket(httpServer: any, eventBus: EventBus) {
  const io = new Server(httpServer, {
    cors: {
      origin: process.env.DASHBOARD_URL || 'http://localhost:3000',
      credentials: true
    },
    transports: ['websocket', 'polling'],
    pingInterval: 15000,      // Heartbeat every 15s
    pingTimeout: 10000,       // Timeout after 10s
    maxHttpBufferSize: 1e6    // 1MB max message size
  });

  // Middleware: Authentication
  io.use((socket, next) => {
    const token = socket.handshake.auth.token;
    if (isValidToken(token)) {
      next();
    } else {
      next(new Error('Authentication failed'));
    }
  });

  // Setup namespaces
  setupStatusNamespace(io, eventBus);
  setupCampaignsNamespace(io, eventBus);
  setupSmartBotNamespace(io, eventBus);

  return io;
}
```

#### **2. Status Namespace (/status):**

```typescript
// ws/namespaces/status.ts
import { Namespace } from 'socket.io';
import { EventBus } from '@waqtor/core';

export function setupStatusNamespace(io: Server, bus: EventBus) {
  const statusNs = io.of('/status');

  statusNs.on('connection', (socket) => {
    console.log(`[/status] Client connected: ${socket.id}`);

    // Send current state immediately
    socket.emit('status', {
      status: bus.getSessionStatus(),
      timestamp: new Date().toISOString()
    });

    // Listen to core events
    const qrHandler = (event: any) => {
      socket.emit('qr', {
        qr: event.data.qr,
        timestamp: event.data.timestamp
      });
    };

    const statusHandler = (event: any) => {
      socket.emit('status', {
        status: event.data.status,
        clientInfo: event.data.clientInfo,
        timestamp: event.data.timestamp
      });
    };

    const statsHandler = (event: any) => {
      socket.emit('stats', {
        messagesSent: event.data.sent,
        messagesReceived: event.data.received,
        timestamp: event.data.timestamp
      });
    };

    // Register handlers
    bus.on('session.qr', qrHandler);
    bus.on('session.status', statusHandler);
    bus.on('session.stats', statsHandler);

    // Cleanup on disconnect
    socket.on('disconnect', () => {
      console.log(`[/status] Client disconnected: ${socket.id}`);
      bus.off('session.qr', qrHandler);
      bus.off('session.status', statusHandler);
      bus.off('session.stats', statsHandler);
    });

    // Heartbeat monitoring
    socket.on('ping', () => {
      socket.emit('pong', { timestamp: Date.now() });
    });
  });
}
```

#### **3. Campaigns Namespace (/campaigns):**

```typescript
// ws/namespaces/campaigns.ts
import { Namespace } from 'socket.io';
import { EventBus } from '@waqtor/core';

export function setupCampaignsNamespace(io: Server, bus: EventBus) {
  const campaignsNs = io.of('/campaigns');

  // Backpressure queue
  const messageQueue: any[] = [];
  const MAX_BROADCAST_RATE = 100; // messages per second
  let lastBroadcast = Date.now();

  campaignsNs.on('connection', (socket) => {
    console.log(`[/campaigns] Client connected: ${socket.id}`);

    // Campaign progress with backpressure
    const progressHandler = (event: any) => {
      const now = Date.now();
      const timeSinceLastBroadcast = now - lastBroadcast;

      if (timeSinceLastBroadcast < (1000 / MAX_BROADCAST_RATE)) {
        // Queue the message
        messageQueue.push({ event: 'progress', data: event.data });
      } else {
        // Broadcast immediately
        socket.emit('progress', {
          campaignId: event.data.campaignId,
          sent: event.data.sent,
          total: event.data.total,
          failed: event.data.failed,
          status: event.data.status,
          timestamp: event.data.timestamp
        });
        lastBroadcast = now;
      }
    };

    const completedHandler = (event: any) => {
      socket.emit('completed', {
        campaignId: event.data.campaignId,
        totalSent: event.data.sent,
        totalFailed: event.data.failed,
        duration: event.data.duration,
        timestamp: event.data.timestamp
      });
    };

    // Register handlers
    bus.on('campaign.progress', progressHandler);
    bus.on('campaign.completed', completedHandler);

    // Process queued messages
    const queueInterval = setInterval(() => {
      if (messageQueue.length > 0) {
        const batch = messageQueue.splice(0, 10); // Send 10 at a time
        batch.forEach(msg => socket.emit(msg.event, msg.data));
      }
    }, 100);

    // Cleanup
    socket.on('disconnect', () => {
      console.log(`[/campaigns] Client disconnected: ${socket.id}`);
      bus.off('campaign.progress', progressHandler);
      bus.off('campaign.completed', completedHandler);
      clearInterval(queueInterval);
    });
  });
}
```

#### **4. SmartBot Namespace (/smartbot):**

```typescript
// ws/namespaces/smartbot.ts
import { Namespace } from 'socket.io';
import { EventBus } from '@waqtor/core';

export function setupSmartBotNamespace(io: Server, bus: EventBus) {
  const smartbotNs = io.of('/smartbot');

  smartbotNs.on('connection', (socket) => {
    console.log(`[/smartbot] Client connected: ${socket.id}`);

    // Incoming messages
    const messageHandler = (event: any) => {
      socket.emit('incoming', {
        from: event.data.from,
        body: event.data.body,
        messageId: event.data.messageId,
        isGroup: event.data.isGroup,
        timestamp: event.data.timestamp
      });
    };

    // SmartBot replies
    const replyHandler = (event: any) => {
      socket.emit('reply', {
        to: event.data.to,
        trigger: event.data.trigger,
        response: event.data.response,
        timestamp: event.data.timestamp
      });
    };

    // Rule updates
    const ruleUpdateHandler = (event: any) => {
      socket.emit('rule-updated', {
        ruleId: event.data.ruleId,
        action: event.data.action, // 'created' | 'updated' | 'deleted'
        timestamp: event.data.timestamp
      });
    };

    // Register handlers
    bus.on('message.received', messageHandler);
    bus.on('smartbot.reply', replyHandler);
    bus.on('smartbot.rule-updated', ruleUpdateHandler);

    // Cleanup
    socket.on('disconnect', () => {
      console.log(`[/smartbot] Client disconnected: ${socket.id}`);
      bus.off('message.received', messageHandler);
      bus.off('smartbot.reply', replyHandler);
      bus.off('smartbot.rule-updated', ruleUpdateHandler);
    });
  });
}
```

---

### **ğŸ’» Client Implementation (Dashboard):**

#### **1. WebSocket Hook:**

```typescript
// hooks/useWebSocket.ts
import { useEffect, useRef, useState } from 'react';
import { io, Socket } from 'socket.io-client';

interface UseWebSocketOptions {
  namespace: string;
  autoConnect?: boolean;
  onConnect?: () => void;
  onDisconnect?: () => void;
  onError?: (error: Error) => void;
}

export function useWebSocket(options: UseWebSocketOptions) {
  const { namespace, autoConnect = true, onConnect, onDisconnect, onError } = options;
  
  const [isConnected, setIsConnected] = useState(false);
  const [latency, setLatency] = useState<number>(0);
  const socketRef = useRef<Socket | null>(null);

  useEffect(() => {
    const WS_URL = process.env.NEXT_PUBLIC_WS_URL || 'http://localhost:8080';
    const token = localStorage.getItem('api_key');

    const socket = io(`${WS_URL}${namespace}`, {
      transports: ['websocket'],
      auth: { token },
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionDelayMax: 5000,
      reconnectionAttempts: Infinity
    });

    socketRef.current = socket;

    // Connection events
    socket.on('connect', () => {
      console.log(`[${namespace}] Connected`);
      setIsConnected(true);
      onConnect?.();
    });

    socket.on('disconnect', (reason) => {
      console.log(`[${namespace}] Disconnected:`, reason);
      setIsConnected(false);
      onDisconnect?.();
    });

    socket.on('connect_error', (error) => {
      console.error(`[${namespace}] Connection error:`, error);
      onError?.(error);
    });

    // Heartbeat
    const heartbeatInterval = setInterval(() => {
      const start = Date.now();
      socket.emit('ping');
      
      socket.once('pong', () => {
        const latency = Date.now() - start;
        setLatency(latency);
      });
    }, 15000);

    // Cleanup
    return () => {
      clearInterval(heartbeatInterval);
      socket.disconnect();
    };
  }, [namespace, onConnect, onDisconnect, onError]);

  const emit = (event: string, data: any) => {
    socketRef.current?.emit(event, data);
  };

  const on = (event: string, handler: (...args: any[]) => void) => {
    socketRef.current?.on(event, handler);
  };

  const off = (event: string, handler?: (...args: any[]) => void) => {
    socketRef.current?.off(event, handler);
  };

  return {
    socket: socketRef.current,
    isConnected,
    latency,
    emit,
    on,
    off
  };
}
```

#### **2. Status WebSocket (Dashboard):**

```typescript
// hooks/useStatusWebSocket.ts
import { useEffect } from 'react';
import { useWebSocket } from './useWebSocket';
import { useAppStore } from '@/store/useAppStore';

export function useStatusWebSocket() {
  const { setQrCode, setSessionStatus, setClientInfo, setStats } = useAppStore();

  const { isConnected, latency, on, off } = useWebSocket({
    namespace: '/status',
    onConnect: () => {
      console.log('Status WebSocket connected');
    },
    onDisconnect: () => {
      console.log('Status WebSocket disconnected');
    }
  });

  useEffect(() => {
    // QR Code updates
    const handleQr = (data: any) => {
      setQrCode(data.qr);
    };

    // Status updates
    const handleStatus = (data: any) => {
      setSessionStatus(data.status);
      if (data.clientInfo) {
        setClientInfo(data.clientInfo);
      }
    };

    // Stats updates
    const handleStats = (data: any) => {
      setStats({
        sent: data.messagesSent,
        received: data.messagesReceived
      });
    };

    // Register listeners
    on('qr', handleQr);
    on('status', handleStatus);
    on('stats', handleStats);

    // Cleanup
    return () => {
      off('qr', handleQr);
      off('status', handleStatus);
      off('stats', handleStats);
    };
  }, [on, off, setQrCode, setSessionStatus, setClientInfo, setStats]);

  return { isConnected, latency };
}
```

#### **3. Campaigns WebSocket:**

```typescript
// hooks/useCampaignsWebSocket.ts
import { useEffect } from 'react';
import { useWebSocket } from './useWebSocket';
import { useCampaignStore } from '@/store/useCampaignStore';

export function useCampaignsWebSocket() {
  const { updateCampaignProgress, markCampaignCompleted } = useCampaignStore();

  const { isConnected, on, off } = useWebSocket({
    namespace: '/campaigns'
  });

  useEffect(() => {
    const handleProgress = (data: any) => {
      updateCampaignProgress(data.campaignId, {
        sent: data.sent,
        total: data.total,
        failed: data.failed,
        status: data.status
      });
    };

    const handleCompleted = (data: any) => {
      markCampaignCompleted(data.campaignId, {
        totalSent: data.totalSent,
        totalFailed: data.totalFailed,
        duration: data.duration
      });
    };

    on('progress', handleProgress);
    on('completed', handleCompleted);

    return () => {
      off('progress', handleProgress);
      off('completed', handleCompleted);
    };
  }, [on, off, updateCampaignProgress, markCampaignCompleted]);

  return { isConnected };
}
```

#### **4. SmartBot WebSocket:**

```typescript
// hooks/useSmartBotWebSocket.ts
import { useEffect } from 'react';
import { useWebSocket } from './useWebSocket';
import { useSmartBotStore } from '@/store/useSmartBotStore';

export function useSmartBotWebSocket() {
  const { addIncomingMessage, addReply, updateRule } = useSmartBotStore();

  const { isConnected, on, off } = useWebSocket({
    namespace: '/smartbot'
  });

  useEffect(() => {
    const handleIncoming = (data: any) => {
      addIncomingMessage({
        from: data.from,
        body: data.body,
        messageId: data.messageId,
        isGroup: data.isGroup,
        timestamp: new Date(data.timestamp)
      });
    };

    const handleReply = (data: any) => {
      addReply({
        to: data.to,
        trigger: data.trigger,
        response: data.response,
        timestamp: new Date(data.timestamp)
      });
    };

    const handleRuleUpdate = (data: any) => {
      updateRule(data.ruleId, data.action);
    };

    on('incoming', handleIncoming);
    on('reply', handleReply);
    on('rule-updated', handleRuleUpdate);

    return () => {
      off('incoming', handleIncoming);
      off('reply', handleReply);
      off('rule-updated', handleRuleUpdate);
    };
  }, [on, off, addIncomingMessage, addReply, updateRule]);

  return { isConnected };
}
```

---

### **ğŸ“Š Connection Status Component:**

```typescript
// components/WebSocketStatus.tsx
'use client';

import { Badge } from 'primereact/badge';
import { useStatusWebSocket } from '@/hooks/useStatusWebSocket';

export function WebSocketStatus() {
  const { isConnected, latency } = useStatusWebSocket();

  return (
    <div className="flex align-items-center gap-2">
      <i 
        className={`pi ${isConnected ? 'pi-wifi' : 'pi-wifi-slash'}`}
        style={{ color: isConnected ? '#16a34a' : '#ef4444' }}
      />
      <Badge 
        value={isConnected ? `${latency}ms` : 'Offline'} 
        severity={isConnected ? 'success' : 'danger'}
      />
    </div>
  );
}
```

---

### **ğŸ”„ Auto-Reconnect Strategy:**

```typescript
// utils/websocket-reconnect.ts
export class WebSocketReconnectManager {
  private reconnectAttempts = 0;
  private maxReconnectAttempts = Infinity;
  private reconnectDelay = 1000;
  private maxReconnectDelay = 30000;

  calculateDelay(): number {
    // Exponential backoff with jitter
    const delay = Math.min(
      this.reconnectDelay * Math.pow(2, this.reconnectAttempts),
      this.maxReconnectDelay
    );
    
    const jitter = Math.random() * 1000;
    return delay + jitter;
  }

  onReconnectAttempt() {
    this.reconnectAttempts++;
    console.log(`Reconnect attempt ${this.reconnectAttempts}`);
  }

  onReconnectSuccess() {
    this.reconnectAttempts = 0;
    console.log('Reconnected successfully');
  }

  shouldReconnect(): boolean {
    return this.reconnectAttempts < this.maxReconnectAttempts;
  }
}
```

---

### **ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

```
ğŸ“ packages/server/src/ws/
â”œâ”€â”€ index.ts                    # WebSocket server setup
â”œâ”€â”€ namespaces/
â”‚   â”œâ”€â”€ status.ts               # /status namespace
â”‚   â”œâ”€â”€ campaigns.ts            # /campaigns namespace
â”‚   â””â”€â”€ smartbot.ts             # /smartbot namespace
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.ts                 # Socket authentication
â”‚   â””â”€â”€ rateLimit.ts            # Rate limiting per socket
â””â”€â”€ utils/
    â”œâ”€â”€ backpressure.ts         # Backpressure queue
    â””â”€â”€ heartbeat.ts            # Heartbeat monitoring

ğŸ“ dashboard/src/hooks/
â”œâ”€â”€ useWebSocket.ts             # Base WebSocket hook
â”œâ”€â”€ useStatusWebSocket.ts       # Status namespace hook
â”œâ”€â”€ useCampaignsWebSocket.ts    # Campaigns namespace hook
â””â”€â”€ useSmartBotWebSocket.ts     # SmartBot namespace hook

ğŸ“ dashboard/src/components/
â””â”€â”€ WebSocketStatus.tsx         # Connection status indicator

ğŸ“ dashboard/src/utils/
â””â”€â”€ websocket-reconnect.ts      # Reconnection manager
```

---

### **âš™ï¸ Configuration:**

```typescript
// .env (Server)
WS_PORT=8080
WS_PING_INTERVAL=15000
WS_PING_TIMEOUT=10000
WS_MAX_BUFFER_SIZE=1048576
DASHBOARD_URL=http://localhost:3000

// .env (Dashboard)
NEXT_PUBLIC_WS_URL=ws://localhost:8080
NEXT_PUBLIC_WS_RECONNECT_DELAY=1000
NEXT_PUBLIC_WS_MAX_RECONNECT_DELAY=30000
```

---

### **ğŸ¯ Benefits (Ø§Ù„ÙÙˆØ§Ø¦Ø¯):**

#### **1. Organization (Ø§Ù„ØªÙ†Ø¸ÙŠÙ…)**
- âœ… Namespaces Ù…Ù†ÙØµÙ„Ø© Ù„ÙƒÙ„ feature
- âœ… Event isolation (Ù„Ø§ ØªØ¯Ø§Ø®Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø«)
- âœ… Easier debugging

#### **2. Performance (Ø§Ù„Ø£Ø¯Ø§Ø¡)**
- âœ… Backpressure handling Ù„Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ÙƒØ«ÙŠÙØ©
- âœ… Message queuing
- âœ… Rate limiting per namespace

#### **3. Reliability (Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©)**
- âœ… Auto-reconnect Ù…Ø¹ exponential backoff
- âœ… Heartbeat monitoring
- âœ… Connection status tracking
- âœ… Error recovery

#### **4. Developer Experience**
- âœ… Type-safe events
- âœ… Reusable hooks
- âœ… Clear separation of concerns
- âœ… Easy to test

---

### **ğŸ§ª Testing:**

```typescript
// tests/ws/status.test.ts
describe('Status Namespace', () => {
  it('should emit QR code on session.qr event', (done) => {
    const client = io('http://localhost:8080/status');
    
    client.on('qr', (data) => {
      expect(data).toHaveProperty('qr');
      expect(data).toHaveProperty('timestamp');
      client.disconnect();
      done();
    });
    
    // Trigger QR event from core
    eventBus.emit('session.qr', { qr: 'test_qr', timestamp: new Date() });
  });

  it('should handle heartbeat', (done) => {
    const client = io('http://localhost:8080/status');
    
    client.emit('ping');
    client.on('pong', (data) => {
      expect(data).toHaveProperty('timestamp');
      client.disconnect();
      done();
    });
  });
});
```

---

### **ğŸ“ˆ Monitoring:**

```typescript
// ws/monitoring.ts
export class WebSocketMonitor {
  private connections = new Map<string, number>();
  
  trackConnection(namespace: string) {
    const count = this.connections.get(namespace) || 0;
    this.connections.set(namespace, count + 1);
  }
  
  trackDisconnection(namespace: string) {
    const count = this.connections.get(namespace) || 0;
    this.connections.set(namespace, Math.max(0, count - 1));
  }
  
  getStats() {
    return {
      total: Array.from(this.connections.values()).reduce((a, b) => a + b, 0),
      byNamespace: Object.fromEntries(this.connections)
    };
  }
}
```

---

## ğŸ”„ **Migration Guide: Ù…Ù† WebSocket Ø§Ù„Ø®Ø§Ù… Ø¥Ù„Ù‰ Socket.IO**

### **ğŸ§­ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ÙØ­Øµ Ø§Ù„Ù€ WebSocket Ø§Ù„Ø­Ø§Ù„ÙŠ**

#### **ğŸ“ Ø§Ù„Ù‡Ø¯Ù:**
Ù…Ø¹Ø±ÙØ©:
- Ø£ÙŠÙ† ÙŠØ¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ WebSocket Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ
- Ù…Ø§ Ø§Ù„Ù€ events Ø§Ù„Ù…ÙØ¹Ù„Ø©ØŸ
- Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙŠÙ† backend ÙˆDashboardØŸ (`ws://` Ø£Ùˆ `wss://`)

#### **ğŸ§© Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙØ­Øµ:**

**1. Ø§Ø¨Ø­Ø« Ø¹Ù† WebSocket Ø§Ù„Ø®Ø§Ù… ÙÙŠ Backend:**

```bash
grep -R "WebSocket" runtime/server
grep -R "new Server" runtime/server
grep -R "ws" runtime/server
```

**Ø¥Ø°Ø§ Ø¸Ù‡Ø±:**
```javascript
const WebSocket = require('ws');
const wss = new WebSocket.Server({ server });
```
â†’ ÙŠØ³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© `ws` Ø§Ù„Ø®Ø§Ù…

**2. ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù†Ø·Ù‚ broadcast:**

```javascript
wss.on('connection', socket => {
  socket.on('message', data => { ... })
});

// Broadcast pattern
wss.clients.forEach(client => {
  client.send(JSON.stringify({ type: 'update', data: ... }))
});
```

**3. Ø§ÙØ­Øµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Dashboard):**

```javascript
// dashboard/src/hooks/useWebSocket.js
const ws = new WebSocket(import.meta.env.VITE_WS_URL);
ws.onmessage = (msg) => { ... }
```

**4. ØªØ­Ù‚Ù‚ Ù…Ù† .env:**

```bash
VITE_WS_URL=ws://localhost:8080
```

#### **ğŸ“‹ Ø§Ù„Ù…Ù„Ø®Øµ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ­Øµ:**
- âœ… Backend = `ws` library
- âœ… Frontend = Native `WebSocket`
- âœ… Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: `qr`, `status`, `campaign_update`
- âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ heartbeat Ø£Ùˆ reconnect ØªÙ„Ù‚Ø§Ø¦ÙŠ

---

### **ğŸ”§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ù„Ù‰ Socket.IO**

#### **âš™ï¸ Ø£ÙˆÙ„Ø§Ù‹: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª**

**Backend:**
```bash
cd runtime/server
npm install socket.io
```

**Frontend (Dashboard):**
```bash
cd dashboard
npm install socket.io-client
```

#### **ğŸ—ï¸ Ø«Ø§Ù†ÙŠØ§Ù‹: ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± (Backend)**

**âœ³ï¸ Ù‚Ø¨Ù„ (WebSocket Ø§Ù„Ø®Ø§Ù…):**

```javascript
const WebSocket = require('ws');
const wss = new WebSocket.Server({ server });

wss.on('connection', (socket) => {
  socket.send(JSON.stringify({ type: 'welcome', data: 'Connected' }));
  
  socket.on('message', (data) => {
    const message = JSON.parse(data);
    // Handle message
  });
});
```

**âœ… Ø¨Ø¹Ø¯ (Socket.IO):**

```javascript
// runtime/server/index.js
const httpServer = require('http').createServer(app);
const { Server } = require('socket.io');

const io = new Server(httpServer, {
  path: '/ws',
  cors: {
    origin: process.env.DASHBOARD_URL || '*',
    methods: ['GET', 'POST'],
    credentials: true
  },
  pingInterval: 15000,      // Heartbeat every 15s
  pingTimeout: 30000,       // Timeout after 30s
  transports: ['websocket', 'polling']
});

// =============== Namespaces =================
const statusNS = io.of('/status');
const campaignsNS = io.of('/campaigns');
const smartbotNS = io.of('/smartbot');

// =============== Status Namespace ===========
statusNS.on('connection', (socket) => {
  console.log('ğŸ”Œ Status client connected:', socket.id);

  // Ø¨Ø« QR Ø¬Ø¯ÙŠØ¯
  socket.emit('qr', { qrCode: 'data:image/png;base64,...' });

  // Ø¨Ø« Ø§Ù„Ø­Ø§Ù„Ø©
  socket.emit('status', { 
    state: 'ready',
    isConnected: true,
    phoneNumber: '971...'
  });

  // Ø¨Ø« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  socket.emit('stats', {
    totalMessages: 1234,
    totalCampaigns: 56,
    activeUsers: 12
  });

  socket.on('disconnect', (reason) => {
    console.log('âš ï¸ Client disconnected:', reason);
  });
});

// =============== Campaigns Namespace ========
campaignsNS.on('connection', (socket) => {
  console.log('ğŸ“¢ Campaign socket connected:', socket.id);

  socket.on('start_campaign', (payload) => {
    console.log('Received campaign start:', payload);
    
    // Emit progress updates
    socket.emit('campaign_progress', { 
      campaignId: payload.id,
      progress: 30,
      sent: 30,
      total: 100
    });
  });

  socket.on('pause_campaign', (payload) => {
    console.log('Pausing campaign:', payload.id);
    socket.emit('campaign_paused', { campaignId: payload.id });
  });
});

// =============== SmartBot Namespace =========
smartbotNS.on('connection', (socket) => {
  console.log('ğŸ¤– SmartBot socket connected:', socket.id);

  socket.on('test_rule', (payload) => {
    // Test SmartBot rule
    socket.emit('test_result', {
      matches: [...],
      confidence: 0.85
    });
  });
});

// =============== Authentication Middleware ==
io.use((socket, next) => {
  const apiKey = socket.handshake.auth?.key;
  if (apiKey === process.env.API_KEY) {
    next();
  } else {
    next(new Error('Unauthorized'));
  }
});

// =============== Connection Monitoring ======
io.engine.on('connection_error', (err) => {
  console.error('âŒ Connection error:', err.code, err.message);
});

setInterval(() => {
  console.log('ğŸ§© Active connections:', {
    status: statusNS.sockets.size,
    campaigns: campaignsNS.sockets.size,
    smartbot: smartbotNS.sockets.size
  });
}, 30000);

// =============== Start Server ===============
const PORT = process.env.PORT || 8080;
httpServer.listen(PORT, () => {
  console.log(`ğŸš€ Server listening on port ${PORT}`);
});
```

#### **ğŸ§© Ø«Ø§Ù„Ø«Ø§Ù‹: ØªØ­Ø¯ÙŠØ« WebSocket Client ÙÙŠ Dashboard**

**âœ³ï¸ Ù‚Ø¨Ù„ (WebSocket Ø§Ù„Ø®Ø§Ù…):**

```javascript
// dashboard/src/hooks/useWebSocket.js
const ws = new WebSocket(import.meta.env.VITE_WS_URL);

ws.onopen = () => console.log('Connected');
ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);
  if (data.type === 'qr') setQr(data.qrCode);
  if (data.type === 'status') setStatus(data.state);
};
ws.onerror = (err) => console.error(err);
ws.onclose = () => console.log('Disconnected');
```

**âœ… Ø¨Ø¹Ø¯ (Socket.IO Client):**

```typescript
// dashboard/src/hooks/useStatusWebSocket.ts
import { io, Socket } from 'socket.io-client';
import { useEffect, useRef } from 'react';
import { useAppStore } from '../store/useAppStore';

export function useStatusWebSocket() {
  const { setQrCode, setSessionStatus, setStats } = useAppStore();
  const socketRef = useRef<Socket | null>(null);

  useEffect(() => {
    // Create connection
    const socket = io(`${import.meta.env.VITE_WS_URL}/status`, {
      path: '/ws',
      transports: ['websocket', 'polling'],
      reconnection: true,
      reconnectionAttempts: 10,
      reconnectionDelay: 3000,
      reconnectionDelayMax: 10000,
      timeout: 20000,
      auth: {
        key: import.meta.env.VITE_API_KEY
      }
    });

    socketRef.current = socket;

    // Connection events
    socket.on('connect', () => {
      console.log('âœ… Connected to /status namespace');
    });

    socket.on('disconnect', (reason) => {
      console.log('âš ï¸ Disconnected from /status:', reason);
    });

    socket.on('connect_error', (error) => {
      console.error('âŒ Connection error:', error.message);
    });

    // Data events
    socket.on('qr', (data) => {
      console.log('ğŸ“± QR Code received');
      setQrCode(data.qrCode);
    });

    socket.on('status', (data) => {
      console.log('ğŸ“Š Status update:', data.state);
      setSessionStatus(data);
    });

    socket.on('stats', (data) => {
      console.log('ğŸ“ˆ Stats update:', data);
      setStats(data);
    });

    // Cleanup
    return () => {
      socket.disconnect();
    };
  }, []);

  return socketRef.current;
}
```

**Campaigns WebSocket Hook:**

```typescript
// dashboard/src/hooks/useCampaignsWebSocket.ts
import { io, Socket } from 'socket.io-client';
import { useEffect, useRef } from 'react';
import { useCampaignStore } from '../store/useCampaignStore';

export function useCampaignsWebSocket() {
  const { updateCampaignProgress, setCampaignStatus } = useCampaignStore();
  const socketRef = useRef<Socket | null>(null);

  useEffect(() => {
    const socket = io(`${import.meta.env.VITE_WS_URL}/campaigns`, {
      path: '/ws',
      transports: ['websocket'],
      reconnection: true,
      auth: {
        key: import.meta.env.VITE_API_KEY
      }
    });

    socketRef.current = socket;

    socket.on('connect', () => {
      console.log('âœ… Connected to /campaigns namespace');
    });

    socket.on('campaign_progress', (data) => {
      updateCampaignProgress(data.campaignId, data);
    });

    socket.on('campaign_completed', (data) => {
      setCampaignStatus(data.campaignId, 'completed');
    });

    socket.on('campaign_paused', (data) => {
      setCampaignStatus(data.campaignId, 'paused');
    });

    socket.on('campaign_failed', (data) => {
      setCampaignStatus(data.campaignId, 'failed');
    });

    return () => {
      socket.disconnect();
    };
  }, []);

  // Helper functions
  const startCampaign = (campaignId: string) => {
    socketRef.current?.emit('start_campaign', { id: campaignId });
  };

  const pauseCampaign = (campaignId: string) => {
    socketRef.current?.emit('pause_campaign', { id: campaignId });
  };

  return {
    socket: socketRef.current,
    startCampaign,
    pauseCampaign
  };
}
```

**Update .env:**

```bash
# Before
VITE_WS_URL=ws://localhost:8080

# After
VITE_WS_URL=http://localhost:8080
VITE_API_KEY=your_secret_api_key_here
```

**Note:** Socket.IO ÙŠØ³ØªØ®Ø¯Ù… `http://` ÙˆÙ„ÙŠØ³ `ws://` Ù„Ø£Ù† Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ ÙŠÙØ¯Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.

---

### **ğŸ§ª Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©**

#### **âœ… 1) ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±**

```bash
cd runtime/server
node index.js
```

**Expected output:**
```
ğŸš€ Server listening on port 8080
ğŸ”Œ Status client connected: abc123
ğŸ“¢ Campaign socket connected: def456
```

#### **âœ… 2) ØªØ´ØºÙŠÙ„ Dashboard**

```bash
cd dashboard
npm run dev
```

**Browser Console:**
```
âœ… Connected to /status namespace
âœ… Connected to /campaigns namespace
ğŸ“± QR Code received
ğŸ“Š Status update: ready
```

#### **âœ… 3) Ø§Ø®ØªØ¨Ø§Ø± Auto-Reconnect**

1. Ø£ÙˆÙ‚Ù Ø§Ù„Ø³ÙŠØ±ÙØ± (`Ctrl+C`)
2. Ø±Ø§Ù‚Ø¨ Dashboard console:
   ```
   âš ï¸ Disconnected from /status: transport close
   ğŸ”„ Trying to reconnect... attempt 1
   ğŸ”„ Trying to reconnect... attempt 2
   ```
3. Ø´ØºÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
4. ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
   ```
   âœ… Connected to /status namespace
   ```

#### **âœ… 4) Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª**

**Add to backend:**

```javascript
// Monitor connections every 10 seconds
setInterval(() => {
  const stats = {
    status: statusNS.sockets.size,
    campaigns: campaignsNS.sockets.size,
    smartbot: smartbotNS.sockets.size,
    total: io.engine.clientsCount
  };
  
  console.log('ğŸ§© Active connections:', stats);
}, 10000);

// Log connection errors
io.engine.on('connection_error', (err) => {
  console.error('âŒ Connection error:', {
    code: err.code,
    message: err.message,
    context: err.context
  });
});
```

---

### **ğŸ§  Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„ØªÙˆØ³Ø¹Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†**

#### **1. Custom Heartbeat:**

```javascript
// runtime/server/ws/heartbeat.js
export function setupHeartbeat(io) {
  io.on('connection', (socket) => {
    let heartbeatInterval;

    socket.on('ping', () => {
      socket.emit('pong', { timestamp: Date.now() });
    });

    heartbeatInterval = setInterval(() => {
      socket.emit('heartbeat', { timestamp: Date.now() });
    }, 15000);

    socket.on('disconnect', () => {
      clearInterval(heartbeatInterval);
    });
  });
}
```

#### **2. Auth Middleware:**

```javascript
// runtime/server/middleware/wsAuth.js
export function wsAuthMiddleware(socket, next) {
  const apiKey = socket.handshake.auth?.key;
  const token = socket.handshake.auth?.token;

  // Verify API Key
  if (apiKey === process.env.API_KEY) {
    return next();
  }

  // Verify JWT Token
  if (token) {
    try {
      const decoded = jwt.verify(token, process.env.JWT_SECRET);
      socket.user = decoded;
      return next();
    } catch (err) {
      return next(new Error('Invalid token'));
    }
  }

  next(new Error('Unauthorized'));
}

// Usage
io.use(wsAuthMiddleware);
```

#### **3. Logging & Metrics:**

```javascript
// runtime/server/utils/wsLogger.js
export class WebSocketLogger {
  constructor() {
    this.metrics = {
      connections: 0,
      disconnections: 0,
      messages: 0,
      errors: 0
    };
  }

  logConnection(namespace, socketId) {
    this.metrics.connections++;
    console.log(`[${new Date().toISOString()}] ğŸ”Œ Connection: ${namespace} - ${socketId}`);
  }

  logDisconnection(namespace, socketId, reason) {
    this.metrics.disconnections++;
    console.log(`[${new Date().toISOString()}] âš ï¸ Disconnection: ${namespace} - ${socketId} - ${reason}`);
  }

  logMessage(namespace, event, data) {
    this.metrics.messages++;
    console.log(`[${new Date().toISOString()}] ğŸ“¨ Message: ${namespace}/${event}`, data);
  }

  logError(error) {
    this.metrics.errors++;
    console.error(`[${new Date().toISOString()}] âŒ Error:`, error);
  }

  getMetrics() {
    return {
      ...this.metrics,
      uptime: process.uptime(),
      timestamp: new Date().toISOString()
    };
  }
}
```

#### **4. Redis Adapter (Ù„Ù„Ù€ Multi-Instance):**

```bash
npm install @socket.io/redis-adapter redis
```

```javascript
// runtime/server/index.js
import { createAdapter } from '@socket.io/redis-adapter';
import { createClient } from 'redis';

const pubClient = createClient({ url: 'redis://localhost:6379' });
const subClient = pubClient.duplicate();

Promise.all([pubClient.connect(), subClient.connect()]).then(() => {
  io.adapter(createAdapter(pubClient, subClient));
  console.log('âœ… Redis adapter connected');
});
```

---

### **ğŸ”’ Ù†ØµØ§Ø¦Ø­ Ø£Ù…Ù†ÙŠØ©**

#### **1. Rate Limiting:**

```javascript
import rateLimit from 'socket.io-rate-limit';

io.use(rateLimit({
  tokensPerInterval: 100,
  interval: 60000, // 1 minute
  fireImmediately: true
}));
```

#### **2. Message Validation:**

```javascript
socket.on('start_campaign', (payload) => {
  // Validate payload
  if (!payload.id || typeof payload.id !== 'string') {
    socket.emit('error', { message: 'Invalid campaign ID' });
    return;
  }

  // Sanitize input
  const sanitizedId = payload.id.trim();
  
  // Process...
});
```

#### **3. CORS Configuration:**

```javascript
const io = new Server(httpServer, {
  cors: {
    origin: [
      'http://localhost:3000',
      'https://yourdomain.com'
    ],
    methods: ['GET', 'POST'],
    credentials: true,
    allowedHeaders: ['Authorization']
  }
});
```

---

### **ğŸ Ø§Ù„Ø®Ù„Ø§ØµØ©**

| Ø§Ù„Ø¹Ù†ØµØ± | Ù‚Ø¨Ù„ (WebSocket Ø§Ù„Ø®Ø§Ù…) | Ø¨Ø¹Ø¯ (Socket.IO) |
|--------|----------------------|-----------------|
| **Ø§ØªØµØ§Ù„ Ø«Ø§Ø¨Øª** | âŒ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§ØªØµØ§Ù„ ÙŠØ¯ÙˆÙŠØ© | âœ… Auto-reconnect |
| **Namespaces** | âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… | âœ… `/status`, `/campaigns`, `/smartbot` |
| **Heartbeat** | âŒ ÙŠØ¯ÙˆÙŠ | âœ… ØªÙ„Ù‚Ø§Ø¦ÙŠ (15s) |
| **Error Handling** | âŒ Ù…Ø­Ø¯ÙˆØ¯ | âœ… Ø´Ø§Ù…Ù„ Ù…Ø¹ retry |
| **Scalability** | âŒ ØµØ¹Ø¨ | âœ… Redis adapter |
| **Authentication** | âŒ ÙŠØ¯ÙˆÙŠ | âœ… Middleware built-in |
| **Monitoring** | âŒ Ù…Ø­Ø¯ÙˆØ¯ | âœ… Metrics + Logging |
| **Browser Support** | âš ï¸ WebSocket ÙÙ‚Ø· | âœ… WebSocket + Polling fallback |

---

## ğŸ—ºï¸ **Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Incremental Roadmap)**

### **Phase A: Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© (4-6 Ø£Ø³Ø§Ø¨ÙŠØ¹)**

#### **Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… Ø¥Ù†Ø´Ø§Ø¡ `packages/core` Ù…Ø¹ Events/Commands ÙƒÙˆØ§Ø¬Ù‡Ø§Øª Ø±Ø³Ù…ÙŠØ©
- âœ… Ù†Ù‚Ù„ WhatsAppClient/SessionManager Ø¥Ù„Ù‰ core
- âœ… Ø¬Ø¹Ù„ server ÙŠØ­Ù‚Ù† core Ø¹Ø¨Ø± DI

#### **Ø§Ù„Ù…Ù‡Ø§Ù…:**

**Week 1-2: Core Package Setup**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `packages/core` directory structure
- [ ] ØªØ¹Ø±ÙŠÙ Event interfaces (`session.qr`, `message.received`, etc.)
- [ ] ØªØ¹Ø±ÙŠÙ Command interfaces (`sendText`, `createCampaign`, etc.)
- [ ] Ø¥Ù†Ø´Ø§Ø¡ EventBus class
- [ ] Unit tests Ù„Ù„Ù€ EventBus

**Week 3-4: Migration**
- [ ] Ù†Ù‚Ù„ WhatsAppClient Ù…Ù† `runtime/server` Ø¥Ù„Ù‰ `packages/core`
- [ ] Ù†Ù‚Ù„ SessionManager Ø¥Ù„Ù‰ core
- [ ] ØªØ­Ø¯ÙŠØ« imports ÙÙŠ server
- [ ] Integration tests

**Week 5-6: Dependency Injection**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `bootstrap.ts` ÙÙŠ server
- [ ] ØªØ·Ø¨ÙŠÙ‚ DI pattern
- [ ] Refactor server routes Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… injected core
- [ ] Documentation update

**Deliverables:**
```
packages/core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ WhatsAppClient.ts
â”‚   â”‚   â”œâ”€â”€ SessionManager.ts
â”‚   â”‚   â””â”€â”€ EventBus.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ events.ts
â”‚   â”‚   â””â”€â”€ commands.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ package.json

packages/server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bootstrap.ts          # DI setup
â”‚   â””â”€â”€ index.ts
```

---

### **Phase B: WebSocket 2.0 (2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹)**

#### **Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… ØªÙ†ÙÙŠØ° Namespaces (`/status`, `/campaigns`, `/smartbot`)
- âœ… Heartbeat + Auto-reconnect + Backpressure
- âœ… ØªØ­Ø¯ÙŠØ« Dashboard hooks

#### **Ø§Ù„Ù…Ù‡Ø§Ù…:**

**Week 1: Server Implementation**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `packages/server/src/ws/` directory
- [ ] ØªØ·Ø¨ÙŠÙ‚ `/status` namespace
- [ ] ØªØ·Ø¨ÙŠÙ‚ `/campaigns` namespace Ù…Ø¹ backpressure
- [ ] ØªØ·Ø¨ÙŠÙ‚ `/smartbot` namespace
- [ ] Heartbeat mechanism (ping/pong every 15s)
- [ ] WebSocket authentication middleware

**Week 2: Client Implementation**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `useWebSocket` base hook
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `useStatusWebSocket` hook
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `useCampaignsWebSocket` hook
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `useSmartBotWebSocket` hook
- [ ] Auto-reconnect Ù…Ø¹ exponential backoff

**Week 3: Testing & Integration**
- [ ] WebSocket connection tests
- [ ] Namespace isolation tests
- [ ] Backpressure tests
- [ ] Dashboard integration
- [ ] Performance testing

**Deliverables:**
```
packages/server/src/ws/
â”œâ”€â”€ index.ts
â”œâ”€â”€ namespaces/
â”‚   â”œâ”€â”€ status.ts
â”‚   â”œâ”€â”€ campaigns.ts
â”‚   â””â”€â”€ smartbot.ts
â””â”€â”€ utils/
    â”œâ”€â”€ backpressure.ts
    â””â”€â”€ heartbeat.ts

dashboard/src/hooks/
â”œâ”€â”€ useWebSocket.ts
â”œâ”€â”€ useStatusWebSocket.ts
â”œâ”€â”€ useCampaignsWebSocket.ts
â””â”€â”€ useSmartBotWebSocket.ts
```

---

### **Phase C: Webhooks (2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹)**

#### **Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… Ù…Ø³Ø§Ø± `/api/webhooks/*` Ù…Ø¹ HMAC signature
- âœ… Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø§Ø±Ø© Webhooks ÙÙŠ Settings
- âœ… Test delivery + logs

#### **Ø§Ù„Ù…Ù‡Ø§Ù…:**

**Week 1: Backend**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ WebhookManager class
- [ ] ØªØ·Ø¨ÙŠÙ‚ HMAC signature (sha256)
- [ ] API routes (CRUD + test)
- [ ] Retry mechanism Ù…Ø¹ exponential backoff
- [ ] Webhook logging

**Week 2: Dashboard**
- [ ] ØµÙØ­Ø© Webhooks management
- [ ] Add/Edit/Delete webhooks
- [ ] Test webhook button
- [ ] Webhook logs viewer
- [ ] MultiSelect Ù„Ù„Ø£Ø­Ø¯Ø§Ø«

**Week 3: Testing & Documentation**
- [ ] Integration tests
- [ ] cURL examples
- [ ] Node.js receiver example
- [ ] Python receiver example
- [ ] WEBHOOKS.md documentation

**Deliverables:**
```
packages/server/src/webhooks/
â”œâ”€â”€ WebhookManager.ts
â”œâ”€â”€ signature.ts
â””â”€â”€ types.ts

packages/server/src/api/
â””â”€â”€ webhooks.ts

dashboard/src/app/(main)/settings/webhooks/
â”œâ”€â”€ page.tsx
â””â”€â”€ logs/page.tsx

documentation/
â””â”€â”€ WEBHOOKS.md
```

---

### **Phase D: SmartBot v2 (3-4 Ø£Ø³Ø§Ø¨ÙŠØ¹)**

#### **Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… Ø·Ø¨Ù‚Ø© Embeddings + ØªØ®Ø²ÙŠÙ† Ù…ØªØ¬Ù‡ÙŠ
- âœ… Migration Ù„Ø¬Ø¯Ø§ÙˆÙ„ embeddings/history
- âœ… Test Bench ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

#### **Ø§Ù„Ù…Ù‡Ø§Ù…:**

**Week 1: Embedding Service**
- [ ] ØªØ«Ø¨ÙŠØª `@xenova/transformers`
- [ ] Ø¥Ù†Ø´Ø§Ø¡ EmbeddingService class
- [ ] ØªØ·Ø¨ÙŠÙ‚ cosine similarity
- [ ] Benchmark performance

**Week 2: Database Migration**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ø¬Ø¯ÙŠØ¯Ø© (embeddings, history, suggestions)
- [ ] Migration script Ù…Ù† JSON Ø¥Ù„Ù‰ SQLite
- [ ] Data validation

**Week 3: SmartBot Engine v2**
- [ ] ØªØ·Ø¨ÙŠÙ‚ Pipeline (8 steps)
- [ ] TemplateEngine class
- [ ] SafetyLayer class
- [ ] Integration Ù…Ø¹ EventBus

**Week 4: Dashboard**
- [ ] Enhanced rule management
- [ ] "Generate Embedding" button
- [ ] Test Bench (Top-3 matches + confidence)
- [ ] Auto-Improve suggestions page

**Deliverables:**
```
packages/server/src/smartbot/
â”œâ”€â”€ EmbeddingService.ts
â”œâ”€â”€ SmartBotEngineV2.ts
â”œâ”€â”€ TemplateEngine.ts
â”œâ”€â”€ SafetyLayer.ts
â””â”€â”€ LanguageDetector.ts

database/migrations/
â””â”€â”€ 003_smartbot_v2.sql

dashboard/src/app/(main)/smartbot/
â”œâ”€â”€ page.tsx (enhanced)
â””â”€â”€ suggestions/
    â””â”€â”€ page.tsx
```

---

### **Phase E: SDK (3-4 Ø£Ø³Ø§Ø¨ÙŠØ¹)**

#### **Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:**
- âœ… `@waqtor/sdk` (Node.js) ÙŠØºÙ„Ù REST/WS/Webhooks
- âœ… Python SDK Ø¨Ù†ÙØ³ Ø§Ù„Ø¹Ù‚ÙˆØ¯

#### **Ø§Ù„Ù…Ù‡Ø§Ù…:**

**Week 1-2: Node.js SDK**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `packages/sdk-node`
- [ ] WaqtorClient class
- [ ] Resources (messages, campaigns, status)
- [ ] WebSocket client wrapper
- [ ] TypeScript definitions
- [ ] Unit tests

**Week 3: Python SDK**
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `packages/sdk-py`
- [ ] WaqtorClient class (Python)
- [ ] Resources implementation
- [ ] Type hints
- [ ] Unit tests

**Week 4: Documentation & Examples**
- [ ] SDK documentation
- [ ] Example projects (basic-bot, campaign-scheduler)
- [ ] API reference
- [ ] Publish to npm/PyPI

**Deliverables:**
```
packages/sdk-node/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ client.ts
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ messages.ts
â”‚   â”‚   â”œâ”€â”€ campaigns.ts
â”‚   â”‚   â””â”€â”€ status.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ examples/
â””â”€â”€ README.md

packages/sdk-py/
â”œâ”€â”€ waqtor/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ client.py
â”‚   â””â”€â”€ resources/
â”œâ”€â”€ examples/
â””â”€â”€ README.md
```

---

## ğŸ“Š **Timeline Summary:**

| Phase | Duration | Start | End | Status |
|-------|----------|-------|-----|--------|
| **Phase A** | 4-6 weeks | Week 1 | Week 6 | ğŸ”µ Planned |
| **Phase B** | 2-3 weeks | Week 7 | Week 9 | ğŸ”µ Planned |
| **Phase C** | 2-3 weeks | Week 10 | Week 12 | ğŸ”µ Planned |
| **Phase D** | 3-4 weeks | Week 13 | Week 16 | ğŸ”µ Planned |
| **Phase E** | 3-4 weeks | Week 17 | Week 20 | ğŸ”µ Planned |
| **Total** | **14-20 weeks** | - | - | **~4-5 months** |

---

## ğŸ“ **Design Contracts (Ù„Ù„Ù€ README Ø§Ù„Ø¹Ø§Ù…)**

### **Event Names:**

```typescript
// Session Events
- 'session.qr'              // QR code generated
- 'session.status'          // Status changed (ready/disconnected/connecting)
- 'session.stats'           // Statistics updated

// Message Events
- 'message.received'        // Incoming message
- 'message.sent'            // Outgoing message sent
- 'message.delivered'       // Message delivered
- 'message.read'            // Message read

// Campaign Events
- 'campaign.progress'       // Campaign execution progress
- 'campaign.completed'      // Campaign finished
- 'campaign.paused'         // Campaign paused
- 'campaign.failed'         // Campaign failed

// SmartBot Events
- 'smartbot.reply'          // Auto-reply sent
- 'smartbot.rule-updated'   // Rule created/updated/deleted
```

### **REST â†’ Commands:**

```typescript
// Message Commands
POST /api/messages/send-text
POST /api/messages/send-media
POST /api/messages/send-button
POST /api/messages/send-list

// Campaign Commands
POST /api/campaigns/create
POST /api/campaigns/:id/execute
POST /api/campaigns/:id/pause
POST /api/campaigns/:id/resume
POST /api/campaigns/:id/cancel
GET  /api/campaigns/:id/status

// Session Commands
GET  /api/session/state
POST /api/session/logout
POST /api/session/restart

// SmartBot Commands
GET  /api/smartbot/rules
POST /api/smartbot/rules
PUT  /api/smartbot/rules/:id
DELETE /api/smartbot/rules/:id
POST /api/smartbot/test

// Webhook Commands
GET  /api/webhooks
POST /api/webhooks
PATCH /api/webhooks/:id
DELETE /api/webhooks/:id
POST /api/webhooks/:id/test
```

---

## ğŸ”„ **Data Flow (Ù„Ù„Ù€ README Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù€ Dashboard)**

### **WebSocket Data Flow:**

```
Backend Events
    â†“
WebSocket Namespaces
    â”œâ”€ /status    â†’ session.qr, session.status, session.stats
    â”œâ”€ /campaigns â†’ campaign.progress, campaign.completed
    â””â”€ /smartbot  â†’ message.received, smartbot.reply
    â†“
Dashboard Hooks
    â”œâ”€ useStatusWebSocket()
    â”œâ”€ useCampaignsWebSocket()
    â””â”€ useSmartBotWebSocket()
    â†“
Zustand Store
    â”œâ”€ setQrCode()
    â”œâ”€ setSessionStatus()
    â”œâ”€ updateCampaignProgress()
    â””â”€ addSmartBotReply()
    â†“
React Components
    â”œâ”€ QRStatusCard
    â”œâ”€ SessionStatsCard
    â”œâ”€ CampaignList
    â””â”€ SmartBotHistory
```

### **REST Data Flow:**

```
User Action
    â†“
React Component
    â†“
React Query Mutation
    â”œâ”€ useMutation('sendMessage')
    â”œâ”€ useMutation('createCampaign')
    â””â”€ useMutation('executeCommand')
    â†“
REST API
    â”œâ”€ POST /api/messages/send-text
    â”œâ”€ POST /api/campaigns/create
    â””â”€ POST /api/campaigns/:id/execute
    â†“
Backend Processing
    â†“
Event Emitted
    â†“
WebSocket Broadcast
    â†“
Dashboard Update (real-time)
```

### **Cache Strategy:**

```typescript
// React Query Cache
- Stale Time: 30 seconds (most queries)
- Cache Time: 5 minutes
- Retry: 3 attempts with exponential backoff
- Refetch on Window Focus: Enabled for critical data

// Zustand Store (UI State)
- Theme, scale, sidebar visibility
- Branding (logo, app name, footer)
- Persisted to localStorage

// WebSocket (Real-time)
- In-memory cache
- No persistence
- Auto-reconnect on disconnect
```

---

**Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡! ğŸš€**
