# ๐ฆ ูุธุงู ุฅุฏุงุฑุฉ ุงููููุงุช ุงูุฌุฏูุฏ - ุงูุชูุซูู ุงูููุงุฆู

## ุงูุชุงุฑูุฎ: 29 ุฃูุชูุจุฑ 2025

---

## ๐ฏ ูุง ุชู ุฅูุฌุงุฒู

### 1. โ ุชูุธูู ุงููููุงุช ุญุณุจ ุงูุชุงุฑูุฎ

#### ูุจู ุงูุชุญุฏูุซ:
```
uploads/
โโโ abc123def456
โโโ xyz789ghi012
โโโ ...
```
โ ูููุงุช ุนุดูุงุฆูุฉ ุจุฏูู ุชุฑุชูุจ

#### ุจุนุฏ ุงูุชุญุฏูุซ:
```
uploads/
โโโ 2025-10-28/
โ   โโโ 1761687119847-test-image.png
โ   โโโ 1761687200000-catalog.pdf
โโโ 2025-10-29/
โ   โโโ 1761773600000-product.jpg
โ   โโโ 1761774000000-video.mp4
โโโ README.md
```
โ ูููุงุช ููุธูุฉ ุญุณุจ ุงูุชุงุฑูุฎ (YYYY-MM-DD)

---

### 2. โ ุญุฏูุฏ ุฃุญุฌุงู ูุฎุชููุฉ ุญุณุจ ููุน ุงูููู

| ููุน ุงูููู | ูุจู | ุจุนุฏ | ุงูุชุบููุฑ |
|----------|-----|-----|---------|
| ุตูุฑ ๐ผ๏ธ | 16MB | **3MB** | โฌ๏ธ ุชูููู |
| PDF ๐ | 16MB | **5MB** | โฌ๏ธ ุชูููู |
| ููุฏูู ๐ฌ | 16MB | **60MB** | โฌ๏ธ ุฒูุงุฏุฉ |
| ูุณุชูุฏุงุช ๐ | 16MB | **10MB** | โฌ๏ธ ุชูููู |
| ุตูุช ๐ต | 16MB | **16MB** | โก๏ธ ููุณ ุงูุญุฏ |

**ุงูููุฏ:**
```javascript
const FILE_LIMITS = {
    IMAGE: 3 * 1024 * 1024,      // 3MB
    PDF: 5 * 1024 * 1024,         // 5MB
    VIDEO: 60 * 1024 * 1024,      // 60MB
    DOCUMENT: 10 * 1024 * 1024,   // 10MB
    AUDIO: 16 * 1024 * 1024       // 16MB
};
```

---

### 3. โ ูุธุงู ุงูุงุญุชูุงุธ ุจุงููููุงุช (30 ููู)

#### ูุจู ุงูุชุญุฏูุซ:
- โ ุงููููุงุช ุชูุญุฐู **ููุฑุงู** ุจุนุฏ ุงูุฅุฑุณุงู
- โ ูุง ูููู ูุฑุงุฌุนุฉ ุงููููุงุช ุงูููุฑุณูุฉ
- โ ูุง ููุฌุฏ ุณุฌู ูููููุงุช

#### ุจุนุฏ ุงูุชุญุฏูุซ:
- โ ุงููููุงุช ุชูุญูุธ ููุฏุฉ **30 ููู**
- โ ูููู ูุฑุงุฌุนุฉ ุงููููุงุช ุงูููุฑุณูุฉ
- โ ุณุฌู ูุงูู ูููููุงุช ูุน ุงููุณุงุฑุงุช

---

### 4. โ ูุธุงู ุงูุชุญุฐูุฑ ูุจู ุงูุญุฐู

#### ุชุญุฐูุฑุงุช ุชููุงุฆูุฉ:
```
โ๏ธ Upload folders will be deleted soon:
   - 2025-09-29 (3 day(s) remaining)
   - 2025-09-30 (2 day(s) remaining)
   - 2025-10-01 (1 day(s) remaining)
```

ุงูุชุญุฐูุฑุงุช ุชุธูุฑ:
- โ ูุจู 3 ุฃูุงู ูู ุงูุญุฐู (ููู 27)
- โ ูุจู ููููู ูู ุงูุญุฐู (ููู 28)
- โ ูุจู ููู ูุงุญุฏ ูู ุงูุญุฐู (ููู 29)

---

### 5. โ ุงูุญุฐู ุงูุชููุงุฆู ุงููููู

#### ุงูุฌุฏููุฉ:
1. **ุนูุฏ ุจุฏุก ุงูุณูุฑูุฑ** - ุชูุธูู ููุฑู
2. **ูู 24 ุณุงุนุฉ** - ุชูุธูู ุฏูุฑู

#### ุณุฌู ุงูุญุฐู:
```
๐๏ธ Deleted old upload folder: 2025-09-28 (30 days old)
๐งน Cleanup complete: 45 old files deleted
```

---

## ๐ ุงูุชุบููุฑุงุช ูู ุงูููุฏ

### ููู: `/runtime/server/routes/message.js`

#### 1. ุฅุถุงูุฉ multer storage ูุฎุตุต:
```javascript
const storage = multer.diskStorage({
    destination: function (req, file, cb) {
        const today = new Date().toISOString().split('T')[0];
        const uploadDir = path.join(__dirname, '../../../uploads', today);
        
        if (!fs.existsSync(uploadDir)) {
            fs.mkdirSync(uploadDir, { recursive: true });
        }
        
        cb(null, uploadDir);
    },
    filename: function (req, file, cb) {
        const timestamp = Date.now();
        const uniqueName = `${timestamp}-${file.originalname}`;
        cb(null, uniqueName);
    }
});
```

#### 2. ุฏุงูุฉ ุงูุชุญูู ูู ุญุฌู ุงูููู:
```javascript
function validateFileSize(file) {
    const mimetype = file.mimetype;
    const size = file.size;
    
    if (mimetype.startsWith('image/')) {
        if (size > FILE_LIMITS.IMAGE) {
            return { valid: false, message: 'Image size exceeds 3MB' };
        }
    }
    // ... ุงููุฒูุฏ ูู ุงูุชุญููุงุช
    
    return { valid: true };
}
```

#### 3. ุฏุงูุฉ ุงูุชูุธูู ุงูุชููุงุฆู:
```javascript
async function cleanupOldFiles() {
    // ูุฑุงุกุฉ ุฌููุน ุงููุฌูุฏุงุช
    // ุญุณุงุจ ุนูุฑ ูู ูุฌูุฏ
    // ุญุฐู ุงููุฌูุฏุงุช ุงูุฃูุฏู ูู 30 ููู
    // ุฅุฑุณุงู ุชุญุฐูุฑุงุช ูููุฌูุฏุงุช ุงููุฑูุจุฉ ูู ุงูุญุฐู
}

// ุชุดุบูู ุนูุฏ ุงูุจุฏุก
cleanupOldFiles();

// ุฌุฏููุฉ ููููุฉ
setInterval(cleanupOldFiles, 24 * 60 * 60 * 1000);
```

#### 4. ุฅุฒุงูุฉ ุงูุญุฐู ุงูููุฑู:
```javascript
// โ ูุจู: ุญุฐู ููุฑู
fs.unlinkSync(uploadedFilePath);

// โ ุจุนุฏ: ุญูุธ ุงูููู
logger.info(`๐ฆ File stored in: ${uploadedFilePath} (will be kept for 30 days)`);
```

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช

### ุงุฎุชุจุงุฑ 1: ุฑูุน ุตูุฑุฉ ุตุบูุฑุฉ (69 bytes)
```bash
node tests/test-send-image.js
```

**ุงููุชูุฌุฉ:**
```json
{
  "success": true,
  "data": {
    "filename": "test-image.png",
    "filesize": 69,
    "mimetype": "image/png",
    "storedPath": "/Users/.../uploads/2025-10-28/1761687119847-test-image.png"
  }
}
```

โ **ุชู ุงูุญูุธ ุจูุฌุงุญ ูู ูุฌูุฏ ุงูููู**

### ุงุฎุชุจุงุฑ 2: ุงูุชุญูู ูู ูุฌูุฏ ุงูููู
```bash
ls -lh uploads/2025-10-28/
```

**ุงููุชูุฌุฉ:**
```
-rw-r--r--  69B  1761687119847-test-image.png
```

โ **ุงูููู ููุฌูุฏ ููุญููุธ**

---

## ๐ ููุงุฑูุฉ ุงููุธุงู ุงููุฏูู ูุงูุฌุฏูุฏ

| ุงูููุฒุฉ | ูุจู | ุจุนุฏ |
|-------|-----|-----|
| **ุชูุธูู ุงููููุงุช** | โ ุนุดูุงุฆู | โ ุญุณุจ ุงูุชุงุฑูุฎ |
| **ุญุฏูุฏ ุงูุญุฌู** | โ๏ธ 16MB ูููู | โ ูุฎุชููุฉ ููู ููุน |
| **ุงูุงุญุชูุงุธ ุจุงููููุงุช** | โ ุญุฐู ููุฑู | โ 30 ููู |
| **ุงูุชุญุฐูุฑุงุช** | โ ูุง ููุฌุฏ | โ ูุจู 3 ุฃูุงู |
| **ุงูุญุฐู ุงูุชููุงุฆู** | โ ูุฏูู | โ ุชููุงุฆู ููููุงู |
| **ุงูุณุฌู** | โ๏ธ ุฌุฒุฆู | โ ูุงูู ูุน ุงููุณุงุฑุงุช |
| **ุงุณุชุนุงุฏุฉ ุงููููุงุช** | โ ูุณุชุญูู | โ ูููู ููุฏุฉ 30 ููู |

---

## ๐ง ุงูุตูุงูุฉ

### ูุฑุงูุจุฉ ูุณุงุญุฉ ุงููุฑุต:
```bash
# ุญุฌู ุฌููุน ุงููููุงุช
du -sh uploads/

# ุญุฌู ูู ููู
du -sh uploads/*/

# ุนุฏุฏ ุงููููุงุช
find uploads/ -type f | wc -l
```

### ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช:
```bash
# ุณุฌู ุงูุชุญุฐูุฑุงุช
tail -f runtime/logs/combined.log | grep "will be deleted soon"

# ุณุฌู ุงูุญุฐู
tail -f runtime/logs/combined.log | grep "Deleted old upload folder"
```

### ุชูุธูู ูุฏูู (ุฅุฐุง ูุฒู ุงูุฃูุฑ):
```bash
# ุญุฐู ูุฌูุฏุงุช ุฃูุฏู ูู 30 ููู
find uploads/ -type d -name "????-??-??" -mtime +30 -exec rm -rf {} \;
```

---

## โ๏ธ ุงูุชูููู

### ุชุนุฏูู ูุฏุฉ ุงูุงุญุชูุงุธ:
```javascript
// ูู runtime/server/routes/message.js
const RETENTION_DAYS = 30; // ุบููุฑ ุงูุฑูู ููุง
```

### ุชุนุฏูู ุญุฏูุฏ ุงูุฃุญุฌุงู:
```javascript
const FILE_LIMITS = {
    IMAGE: 3 * 1024 * 1024,      // ุบููุฑ ููุง
    PDF: 5 * 1024 * 1024,         // ุบููุฑ ููุง
    VIDEO: 60 * 1024 * 1024,      // ุบููุฑ ููุง
    DOCUMENT: 10 * 1024 * 1024,   // ุบููุฑ ููุง
    AUDIO: 16 * 1024 * 1024       // ุบููุฑ ููุง
};
```

### ุชุนุทูู ุงูุญุฐู ุงูุชููุงุฆู:
```javascript
// ุนููู ุนูู ูุฐุง ุงูุณุทุฑ:
// setInterval(cleanupOldFiles, 24 * 60 * 60 * 1000);
```

---

## ๐จ ููุงุญุธุงุช ูููุฉ

1. **ุงููุณุฎ ุงูุงุญุชูุงุทู**:
   - ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุฌูุฏ `uploads/` ุฅุฐุง ููุช ุชุญุชุงุฌ ุงููููุงุช ููุชุฑุฉ ุฃุทูู

2. **ูุณุงุญุฉ ุงููุฑุต**:
   - ุฑุงูุจ ูุณุงุญุฉ ุงููุฑุตุ ุฎุงุตุฉ ูุน ุงูููุฏูููุงุช (60MB ููู ููู)
   - ูุน 100 ููู ููุฏูู ููููุงู = 6GB ููููุงู = 180GB ุดูุฑูุงู

3. **ุงูุฃูุงู**:
   - ุงููุฌูุฏ `uploads/` ูุฌุจ ุฃูุง ูููู accessible ุนุจุฑ ุงูููุจ
   - ูุง ุชุดุงุฑู ุงููุณุงุฑุงุช ุงููุงููุฉ ูู API responses ูููุณุชุฎุฏููู

4. **ุงูุฃุฏุงุก**:
   - ุงูุญุฐู ุงูุชููุงุฆู ูุนูู ูู ุงูุฎูููุฉ ููุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก
   - ูููู ุชุดุบููู ูู ููุช ูุญุฏุฏ (ูุซูุงู 3 ุตุจุงุญุงู) ุจุฏูุงู ูู ูู 24 ุณุงุนุฉ

---

## ๐ ุงูุฏุนู ูุงูุฃุณุฆูุฉ

### ุฃูู ุฃุฌุฏ ุงููููุงุช ุงููุฑุณูุฉุ
```
/Users/sunmarke/Downloads/Waqtor-main/uploads/YYYY-MM-DD/
```

### ููู ุฃุนุฑู ูุชู ุณูุชู ุญุฐู ููู ูุนููุ
ุงุญุณุจ 30 ููู ูู ุชุงุฑูุฎ ุงููุฌูุฏ. ูุซูุงู:
- ูุฌูุฏ: `2025-10-01`
- ุณููุญุฐู ูู: `2025-10-31`

### ูู ูููู ุงุณุชุนุงุฏุฉ ููู ูุญุฐููุ
โ ูุงุ ุจุนุฏ ุงูุญุฐู ูุง ูููู ุงุณุชุนุงุฏุฉ ุงูููู. ุงุญุชูุธ ุจูุณุฎ ุงุญุชูุงุทูุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ.

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุฏุงุฑุฉ ูููุงุช ูุชูุฏู ูุชุถูู:

โ ุชูุธูู ุชููุงุฆู ุญุณุจ ุงูุชุงุฑูุฎ  
โ ุญุฏูุฏ ุฃุญุฌุงู ูุฎุตุตุฉ ููู ููุน  
โ ุงุญุชูุงุธ ุจุงููููุงุช ููุฏุฉ 30 ููู  
โ ุชุญุฐูุฑุงุช ูุจู ุงูุญุฐู  
โ ุญุฐู ุชููุงุฆู ูููู  
โ ุณุฌู ูุงูู ูููุตูู  

ุงููุธุงู ุงูุขู **ุฌุงูุฒ ููุฅูุชุงุฌ** ููููู ุงุณุชุฎุฏุงูู ุจุซูุฉ! ๐

---

**ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ**: 29 ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 2.0.0  
**ุงูุญุงูุฉ**: โ ุชู ุงูุงุฎุชุจุงุฑ ูุงูุชูุซูู ุจุงููุงูู
