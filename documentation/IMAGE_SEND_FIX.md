# ุฅุตูุงุญ ุฅุฑุณุงู ุงูุตูุฑ ูู WaQtor

## ุงููุดููุฉ ๐ด
ุนูุฏ ุฅุฑุณุงู ุตูุฑุฉ ุนุจุฑ endpoint `/api/messages/send-file`ุ ูุงูุช ุงูุตูุฑ ุชุตู ุนูู WhatsApp ูู **Document** (ูุณุชูุฏ) ูููุณ ูู **Media** (ุตูุฑุฉ ูุน ูุนุงููุฉ).

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐
ูู ุงูููุฏ ุงูุณุงุจูุ ููุง ูุณุชุฎุฏู:
```javascript
const media = MessageMedia.fromFilePath(file.path);
media.filename = file.originalname;
```

ุงููุดููุฉ: `MessageMedia.fromFilePath()` ูุง ูุญุฏุฏ `mimetype` ุจุดูู ุตุญูุญุ ููุง ูุฌุนู WhatsApp ูุชุนุงูู ูุน ุงูุตูุฑ ููุณุชูุฏุงุช ุนุงูุฉ.

## ุงูุญู โ
ุชู ุชุนุฏูู ุงูููุฏ ููุณุชุฎุฏู `MessageMedia` constructor ูุจุงุดุฑุฉ ูุน ุชูุฑูุฑ `mimetype` ุจุดูู ุตุฑูุญ:

```javascript
const fileData = fs.readFileSync(file.path, { encoding: 'base64' });
const media = new MessageMedia(file.mimetype, fileData, file.originalname);
```

### ุงููุฑู ุงูุฃุณุงุณู:
- **ูุจู**: WhatsApp ูุง ูุนุฑู ููุน ุงูููู โ ูุนุฑุถู ููุณุชูุฏ
- **ุจุนุฏ**: WhatsApp ูุนุฑู ููุน ุงูููู (image/png, image/jpeg, etc.) โ ูุนุฑุถู ูุตูุฑุฉ ูุน Preview

## ุงูุชุบููุฑุงุช ูู ุงูููุฏ ๐

### 1. ุชุญุฏูุซ `/runtime/server/routes/message.js`

```javascript
// โ ุงูููุฏ ุงููุฏูู
const media = MessageMedia.fromFilePath(file.path);
media.filename = file.originalname;

// โ ุงูููุฏ ุงูุฌุฏูุฏ
const fileData = fs.readFileSync(file.path, { encoding: 'base64' });
const media = new MessageMedia(file.mimetype, fileData, file.originalname);
```

### 2. ุชุญุณูู ุฃููุงุน ุงููููุงุช ุงููุฏุนููุฉ

ุชู ุชูุณูุน `multer fileFilter` ูุฏุนู ุงููุฒูุฏ ูู ุฃููุงุน ุงููููุงุช:

**ุงูุฃููุงุน ุงููุฏุนููุฉ ุงูุขู:**
- **ุตูุฑ**: JPEG, JPG, PNG, GIF, WebP, BMP, SVG
- **ูุณุชูุฏุงุช**: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT
- **ููุฏูู**: MP4, AVI, MOV, WMV
- **ุตูุช**: MP3, WAV, OGG

### 3. ุชุญุณูู ูุนุงููุฉ ุงููููุงุช ูู ูุงุฌูุฉ HTML

ุชู ุชุญุณูู ุฏุงูุฉ `previewFile()` ูุชุฏุนู:
- ูุนุงููุฉ ุงูุตูุฑ (ูุน ุนุฑุถ ุงูุตูุฑุฉ)
- ูุนุงููุฉ ุงูููุฏูู (ูุน ูุดุบู ููุฏูู)
- ูุนุงููุฉ ุงูุตูุช (ูุน ูุดุบู ุตูุช)
- ุฃููููุงุช ููุงุณุจุฉ ููู ููุน ููู

## ุงูุงุฎุชุจุงุฑุงุช ๐งช

### ูููุงุช ุงูุงุฎุชุจุงุฑ ุงููุถุงูุฉ:

1. **`tests/test-send-image.js`**
   - ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุตูุฑุฉ PNG ูุงุญุฏุฉ
   - ุงูุชุญูู ูู ุธููุฑูุง ูุตูุฑุฉ ูุน Preview

2. **`tests/test-multiple-files.js`**
   - ุงุฎุชุจุงุฑ ุฅุฑุณุงู PNG, PDF, JPG
   - ุงูุชุญูู ูู ุธููุฑ ูู ููุน ุจุงูุดูู ุงูุตุญูุญ

### ููููุฉ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช:

```bash
# ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุตูุฑุฉ ูุงุญุฏุฉ
node tests/test-send-image.js

# ุงุฎุชุจุงุฑ ุฃููุงุน ูููุงุช ูุชุนุฏุฏุฉ
node tests/test-multiple-files.js
```

## ุงูุชุญูู ูู ุงููุชุงุฆุฌ ๐ฑ

ุจุนุฏ ุฅุฑุณุงู ุงููููุงุชุ ุชุญูู ูู WhatsApp:

### ุงูุตูุฑ (PNG, JPG, WebP, GIF):
- โ ุชุธูุฑ ูุตูุฑุฉ (Media)
- โ Preview ูุฑุฆู ูุจู ูุชุญ ุงูุตูุฑุฉ
- โ Caption ูุธูุฑ ุฃุณูู ุงูุตูุฑุฉ
- โ ูููู ุงูุชูุจูุฑ/ุงูุชุตุบูุฑ ูุจุงุดุฑุฉ

### ุงููุณุชูุฏุงุช (PDF, DOC, DOCX):
- โ ุชุธูุฑ ููุณุชูุฏ (Document)
- โ ุงุณู ุงูููู ูุญุฌูู ูุฑุฆู
- โ Caption ูุธูุฑ ูุน ุงูููู
- โ ูุญุชุงุฌ ุชูุฒูู ุฃู ูุชุญ ูุนุฑุถ ุงููุญุชูู

### ุงูููุฏูู (MP4, AVI, MOV):
- โ ุชุธูุฑ ูููุฏูู (Video)
- โ Thumbnail ูุฑุฆู
- โ ูููู ุชุดุบููู ูุจุงุดุฑุฉ ูู WhatsApp

### ุงูุตูุช (MP3, WAV, OGG):
- โ ุชุธูุฑ ูููู ุตูุชู (Voice Note ุฃู Audio)
- โ ูููู ุชุดุบููู ูุจุงุดุฑุฉ

## ุงููููุงุช ุงููุนุฏูุฉ ๐

1. `/runtime/server/routes/message.js` - ุฅุตูุงุญ endpoint ุฅุฑุณุงู ุงููููุงุช
2. `/docs/websocket-test.html` - ุชุญุณูู ูุนุงููุฉ ุงููููุงุช
3. `/tests/test-send-image.js` - ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุตูุฑุฉ
4. `/tests/test-multiple-files.js` - ุงุฎุชุจุงุฑ ุฃููุงุน ูููุงุช ูุชุนุฏุฏุฉ

## ููุงุญุธุงุช ูููุฉ โ๏ธ

1. **ุญุฌู ุงูููู**: ุงูุญุฏ ุงูุฃูุตู 16MB (ูุญุฏุฏ ูู multer config)
2. **API Key**: ูุฌุจ ุชูุฑูุฑ API key ูู header `X-API-Key`
3. **Port**: ุงูุณูุฑูุฑ ูุนูู ุนูู port 8080 (ูููุณ 3000)
4. **Caption**: ุงุฎุชูุงุฑูุ ูููู ุฅุฑุณุงูู ูุงุฑุบ

## ุงุณุชุฎุฏุงู API ๐

### ุฅุฑุณุงู ุตูุฑุฉ ูุน Caption:

```bash
curl -X POST http://localhost:8080/api/messages/send-file \
  -H "X-API-Key: waqtor_default_key_change_me_in_production" \
  -F "phone=201234567890" \
  -F "caption=๐ผ๏ธ ุตูุฑุฉ ุฌูููุฉ!" \
  -F "file=@path/to/image.jpg"
```

### ุฅุฑุณุงู PDF ูุน Caption:

```bash
curl -X POST http://localhost:8080/api/messages/send-file \
  -H "X-API-Key: waqtor_default_key_change_me_in_production" \
  -F "phone=201234567890" \
  -F "caption=๐ ูุชุงููุฌ ุงูููุชุฌุงุช 2025" \
  -F "file=@path/to/catalog.pdf"
```

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ โจ

- โ ุงูุตูุฑ ุชุตู ูุตูุฑ ูุน Preview (ููุณ ููุณุชูุฏุงุช)
- โ ุฏุนู ุฃููุงุน ูููุงุช ูุชุนุฏุฏุฉ (ุตูุฑุ ููุฏููุ ุตูุชุ ูุณุชูุฏุงุช)
- โ ูุนุงููุฉ ุงููููุงุช ูุจู ุงูุฅุฑุณุงู ูู ุงููุงุฌูุฉ
- โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ููุชุฃูุฏ ูู ุนูู ูู ุดูุก ุจุดูู ุตุญูุญ
- โ ุชูุซูู ูุงูู ููุชุบููุฑุงุช

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 29 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ ูุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ
