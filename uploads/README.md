# 📁 Uploads Directory - File Storage System

## نظام تخزين الملفات في WaQtor

هذا المجلد يحتوي على جميع الملفات المرسلة عبر WhatsApp، منظمة حسب التاريخ.

---

## 📂 هيكل المجلدات

```
uploads/
├── 2025-10-29/           ← ملفات يوم 29 أكتوبر 2025
│   ├── 1730236800000-image1.png
│   ├── 1730237000000-catalog.pdf
│   └── 1730237200000-video.mp4
├── 2025-10-30/           ← ملفات يوم 30 أكتوبر 2025
│   └── ...
└── README.md             ← هذا الملف
```

كل مجلد يمثل يوم واحد بتاريخ **YYYY-MM-DD**.

---

## 📊 حدود أحجام الملفات

| نوع الملف | الحد الأقصى | الامتدادات المدعومة |
|----------|-------------|---------------------|
| **صور** 🖼️ | **3 MB** | JPG, PNG, GIF, WebP, BMP, SVG |
| **PDF** 📄 | **5 MB** | PDF |
| **فيديو** 🎬 | **60 MB** | MP4, AVI, MOV, WMV |
| **صوت** 🎵 | **16 MB** | MP3, WAV, OGG |
| **مستندات** 📝 | **10 MB** | DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT |

---

## 🗑️ سياسة الحذف التلقائي

### مدة الاحتفاظ: **30 يوم**

- ✅ الملفات تُحفظ لمدة **30 يوم** من تاريخ الرفع
- ⚠️ **تحذير** يُرسل قبل 3 أيام من الحذف (اليوم 27، 28، 29)
- 🗑️ **الحذف التلقائي** يحدث يومياً عند منتصف الليل

### التحذيرات

عندما يقترب مجلد من الحذف (3 أيام متبقية)، سيظهر تحذير في لوق السيرفر:

```
⚠️ Upload folders will be deleted soon:
   - 2025-09-29 (3 day(s) remaining)
   - 2025-09-30 (2 day(s) remaining)
   - 2025-10-01 (1 day(s) remaining)
```

### عملية الحذف

```
🗑️ Deleted old upload folder: 2025-09-28 (30 days old)
🧹 Cleanup complete: 45 old files deleted
```

---

## 🔄 جدولة التنظيف

### متى يحدث التنظيف؟

1. **عند بدء السيرفر** - تنظيف فوري للملفات القديمة
2. **يومياً** - كل 24 ساعة (منتصف الليل)

### تشغيل التنظيف يدوياً

إذا أردت تنظيف الملفات القديمة يدوياً، يمكنك:

```javascript
// في runtime/server/routes/message.js
// استدعاء دالة cleanupOldFiles() يدوياً
```

---

## 📝 أسماء الملفات

كل ملف يُحفظ باسم فريد:

```
[timestamp]-[originalname]
```

**مثال:**
```
1730236800000-my-product-image.png
```

- `1730236800000` = Unix timestamp (وقت الرفع بالميلي ثانية)
- `my-product-image.png` = الاسم الأصلي للملف

هذا يضمن عدم تكرار أسماء الملفات.

---

## 🔍 تتبع الملفات

عند إرسال ملف بنجاح، يُسجل في اللوق:

```
✅ File sent successfully to 201234567890: catalog.pdf
📦 File stored in: uploads/2025-10-29/1730236800000-catalog.pdf (will be kept for 30 days)
```

يمكنك استخدام هذا المسار لاحقاً لاستعادة أو مراجعة الملف.

---

## 📈 إحصائيات التخزين

لمعرفة حجم الملفات المخزنة:

```bash
# حجم جميع الملفات
du -sh uploads/

# حجم كل يوم
du -sh uploads/*/

# عدد الملفات
find uploads/ -type f | wc -l
```

---

## ⚙️ التكوين

يمكن تعديل الإعدادات في `runtime/server/routes/message.js`:

```javascript
// حدود الأحجام
const FILE_LIMITS = {
    IMAGE: 3 * 1024 * 1024,      // 3MB
    PDF: 5 * 1024 * 1024,         // 5MB
    VIDEO: 60 * 1024 * 1024,      // 60MB
    DOCUMENT: 10 * 1024 * 1024,   // 10MB
    AUDIO: 16 * 1024 * 1024       // 16MB
};

// مدة الاحتفاظ (بالأيام)
const RETENTION_DAYS = 30;
```

---

## 🚨 ملاحظات مهمة

1. **لا تحذف المجلدات يدوياً** - دع النظام يديرها تلقائياً
2. **احتفظ بنسخ احتياطية** إذا كنت تحتاج الملفات لفترة أطول
3. **راقب المساحة** - تأكد من وجود مساحة كافية على القرص
4. **الملفات الكبيرة** - الفيديوهات (60MB) قد تستهلك مساحة كبيرة

---

## 📞 الدعم

في حالة وجود مشاكل، راجع:
- `/runtime/logs/combined.log` - جميع السجلات
- `/runtime/logs/error.log` - سجلات الأخطاء فقط

---

**آخر تحديث**: 29 أكتوبر 2025
